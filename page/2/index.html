<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>hellolc</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="hellolc">
<meta property="og:url" content="http://blog.hellolc.com/page/2/index.html">
<meta property="og:site_name" content="hellolc">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="hellolc">
  
    <link rel="alternate" href="/atom.xml" title="hellolc" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">hellolc</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.hellolc.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-cpp" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/02/23/cpp/" class="article-date">
  <time datetime="2018-02-23T01:54:22.000Z" itemprop="datePublished">2018-02-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/02/23/cpp/">cpp</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><h3 id="别名引用"><a href="#别名引用" class="headerlink" title="别名引用"></a>别名引用</h3><blockquote>
<p>别名引用实质就是一个常量指针 <code>Type&amp; variable == Type* const variable</code></p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">int</span> &amp;b = a;</span><br><span class="line"></span><br><span class="line">    a = <span class="number">20</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"a: "</span> &lt;&lt; a &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>; <span class="comment">//20</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"b: "</span> &lt;&lt; b &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>; <span class="comment">// 20</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="引用可做函数返回值"><a href="#引用可做函数返回值" class="headerlink" title="引用可做函数返回值"></a>引用可做函数返回值</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span>&amp; <span class="title">getA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"a: "</span> &lt;&lt; a &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    getA() = <span class="number">10</span>;</span><br><span class="line">    getA() = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="常量引用"><a href="#常量引用" class="headerlink" title="常量引用"></a>常量引用</h3><blockquote>
<p><code>const Type&amp; variable == const Type* const variable</code></p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> &amp;b = a;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> &amp;c = <span class="number">1</span>;</span><br><span class="line">    a = <span class="number">10</span>;</span><br><span class="line">    <span class="comment">// b = 100; //报错</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"a: "</span> &lt;&lt; a &lt;&lt; <span class="string">" b: "</span> &lt;&lt; b &lt;&lt; <span class="string">" c:"</span> &lt;&lt; c &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><h3 id="inline内联函数"><a href="#inline内联函数" class="headerlink" title="inline内联函数"></a>inline内联函数</h3><blockquote>
<p>inline函数可以减少函数进栈出栈所消耗的性能, 一般用于一些简单的逻辑</p>
</blockquote>
<h4 id="define与inline函数的区别"><a href="#define与inline函数的区别" class="headerlink" title="define与inline函数的区别"></a>define与inline函数的区别</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FUNC(a, b) ((a) &lt; (b) ? (a) : (b))</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">FUNC2</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a &lt; b ? a : b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> b = <span class="number">3</span>;</span><br><span class="line"><span class="comment">//    int c = FUNC(++a, b); // ((a++) &lt; (b) ? (a++) : (b)) a :3 b:3 c: 3</span></span><br><span class="line"><span class="comment">//    cout &lt;&lt; "a :" &lt;&lt; a &lt;&lt; " b:" &lt;&lt; b &lt;&lt; " c: " &lt;&lt; c &lt;&lt; endl;</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> c = FUNC2(++a, b); <span class="comment">//((a++) &lt; (b) ? (a) : (b))  a :2 b:3 c: 2</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"a :"</span> &lt;&lt; a &lt;&lt; <span class="string">" b:"</span> &lt;&lt; b &lt;&lt; <span class="string">" c: "</span> &lt;&lt; c &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>
<h2 id="构造方法与析构方法"><a href="#构造方法与析构方法" class="headerlink" title="构造方法与析构方法"></a>构造方法与析构方法</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myClass</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> _age;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    myClass() &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"无参构造"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    myClass(<span class="keyword">int</span> age) &#123;</span><br><span class="line">        _age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    myClass(<span class="keyword">const</span> myClass &amp;obj) &#123;</span><br><span class="line">        _age = obj._age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~myClass() &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"我是析构方法"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">void</span> myClass::setAge(<span class="keyword">int</span> age)&#123;</span><br><span class="line">        _age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    <span class="function">myClass <span class="title">c</span><span class="params">(<span class="number">18</span>)</span></span>;</span><br><span class="line">    myClass d = c;</span><br><span class="line">    myClass e;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"age: "</span> &lt;&lt; c.getAge() &lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"age: "</span> &lt;&lt; d.getAge() &lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="当一个类含有变量是类并有有参构造方法"><a href="#当一个类含有变量是类并有有参构造方法" class="headerlink" title="当一个类含有变量是类并有有参构造方法"></a>当一个类含有变量是类并有有参构造方法</h3><blockquote>
<p>必须要初始化参数类的构造方法</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">c1</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    c1(<span class="keyword">int</span> a) &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"c1 构造方法 "</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ~c1() &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"c1 析构方法"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">c2</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    c1 a1;</span><br><span class="line">    c1 a2;</span><br><span class="line">    c2(<span class="keyword">int</span> m1, <span class="keyword">int</span> m2, <span class="keyword">int</span> m3) : a1(m2), a2(m3)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"c2 构造方法 "</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ~c2() &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"c2 析构方法"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    <span class="function">c2 <span class="title">a2</span><span class="params">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span></span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    c1 构造方法</span></span><br><span class="line"><span class="comment">    c1 构造方法 </span></span><br><span class="line"><span class="comment">    c2 构造方法 </span></span><br><span class="line"><span class="comment">    c2 析构方法</span></span><br><span class="line"><span class="comment">    c1 析构方法</span></span><br><span class="line"><span class="comment">    c1 析构方法</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="构造方法里调构造方法问题"><a href="#构造方法里调构造方法问题" class="headerlink" title="构造方法里调构造方法问题"></a>构造方法里调构造方法问题</h3><blockquote>
<p>会直接初始化一个类, 然后直接析构掉</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">c3</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> _a;</span><br><span class="line">    <span class="keyword">int</span> _b;</span><br><span class="line">    <span class="keyword">int</span> _c;</span><br><span class="line">    c3(<span class="keyword">int</span> a, <span class="keyword">int</span> b) &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"2个参数构造方法"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        c3(a, b, <span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    c3 (<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> c) &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"3个参数构造方法"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        _a = a;</span><br><span class="line">        _b = b;</span><br><span class="line">        _c = c;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printParmas</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"_a: "</span> &lt;&lt; _a &lt;&lt; <span class="string">" _b: "</span> &lt;&lt; _b &lt;&lt; <span class="string">" _c: "</span> &lt;&lt; _c &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    ~c3() &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"析构方法被调用"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    <span class="function">c3 <span class="title">c</span><span class="params">(<span class="number">1</span>, <span class="number">2</span>)</span></span>;</span><br><span class="line">    c.printParmas();</span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">    2个参数构造方法</span></span><br><span class="line"><span class="comment">    3个参数构造方法</span></span><br><span class="line"><span class="comment">    析构方法被调用</span></span><br><span class="line"><span class="comment">    _a: 0 _b: 0 _c: 0</span></span><br><span class="line"><span class="comment">    析构方法被调用</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="类中的static变量"><a href="#类中的static变量" class="headerlink" title="类中的static变量"></a>类中的static变量</h3><blockquote>
<p>同一个类的所有对象公用同一个static变量</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">c4</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> b;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">coutParams</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"a: "</span> &lt;&lt; a &lt;&lt; <span class="string">" b: "</span> &lt;&lt; b &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addParams</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        a ++;</span><br><span class="line">        b ++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> c4::b = <span class="number">0</span>; <span class="comment">//必须在外面声明</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    c4 c1, c2;</span><br><span class="line">    c1.coutParams();</span><br><span class="line">    c2.coutParams();</span><br><span class="line">    c1.addParams();</span><br><span class="line">    c2.addParams();</span><br><span class="line">    c1.coutParams();</span><br><span class="line">    c2.coutParams();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="类中的static方法"><a href="#类中的static方法" class="headerlink" title="类中的static方法"></a>类中的static方法</h3><blockquote>
<p>static方法中只能使用static变量</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">c5</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> b;</span><br><span class="line">    <span class="comment">//static方法中只能使用static变量</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">coutParams</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">" b: "</span> &lt;&lt; b &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addParams</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        a ++;</span><br><span class="line">        b ++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> c5::b = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    c5 c1, c2;</span><br><span class="line">    c1.coutParams();</span><br><span class="line">    c1.addParams();</span><br><span class="line">    c5::coutParams();</span><br><span class="line">    c1.coutParams();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="类的大小"><a href="#类的大小" class="headerlink" title="类的大小"></a>类的大小</h3><blockquote>
<p>下面这个类对象只占4字节而不是16字节, 他们是怎么分配内存的呢? 其实c5是用结构体实现的, 只有a变量是放在结构体c1的内存里, 静态变量b和静态方法coutParams都放在全局内存区, addParams放在代码内存区;<br>那么问题来了, 那调用addParams时如何区别是哪个对象调用的呢? 其实cpp编译会将当前对象以一个变量名为<code>this</code>的变量传递给方法, 因此这也是为什么我们能再方法内使用<code>this</code>变量来调用对象的变量和方法</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">c5</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> b;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">coutParams</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">" b: "</span> &lt;&lt; b &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addParams</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        a ++;</span><br><span class="line">        b ++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">int</span> c5::b = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    c5 c1;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"c1 size: "</span> &lt;&lt; <span class="keyword">sizeof</span>(c1) &lt;&lt; <span class="built_in">endl</span>; <span class="comment">// 4</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// c5转换为c代码是如下</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">c5</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//代码区</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addParams</span><span class="params">(<span class="keyword">const</span> c5 <span class="keyword">this</span>)</span> </span>&#123;</span><br><span class="line">    a ++;</span><br><span class="line">    b ++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//静态区</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> b;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">coutParams</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">" b: "</span> &lt;&lt; b &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="new和delete"><a href="#new和delete" class="headerlink" title="new和delete"></a>new和delete</h3><blockquote>
<p>new/delete与malloc/free 功能类似, 都是向堆区申请内存, 并且可以混用, 但是new会调用类的构造方法, delete会调用类的析构方法</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">   <span class="keyword">int</span> * p1 = <span class="keyword">new</span> <span class="keyword">int</span>(<span class="number">11</span>);</span><br><span class="line">    <span class="keyword">char</span> * p2 = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">100</span>];</span><br><span class="line">    <span class="built_in">strcpy</span>(p2, <span class="string">"hello world"</span>);</span><br><span class="line">    c3* p3 = <span class="keyword">new</span> c3(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"p1: "</span> &lt;&lt; *p1 &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"p2: "</span> &lt;&lt; p2 &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">delete</span> p1;</span><br><span class="line">    <span class="keyword">delete</span> []p2;</span><br><span class="line">    <span class="keyword">delete</span> p3;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="类的const"><a href="#类的const" class="headerlink" title="类的const"></a>类的const</h3><blockquote>
<p>void setA() const ==&gt; void setA(const c1 * const this)</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">c1</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setA</span><span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// this-&gt;a = 100; 这里会报错 因为有const修饰</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>-&gt;a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    c1 c;</span><br><span class="line">    c.setA();</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt; <span class="string">" a: "</span> &lt;&lt; c.getA() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="方法返回类引用"><a href="#方法返回类引用" class="headerlink" title="方法返回类引用"></a>方法返回类引用</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C1</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    C1(<span class="keyword">int</span> a = <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;a = a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">C1&amp; <span class="title">add</span><span class="params">(C1 c2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;a = <span class="keyword">this</span>-&gt;a + c2.a;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">" a: "</span> &lt;&lt; <span class="keyword">this</span>-&gt;a &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    C1 c1(1), c2(2);</span><br><span class="line">    c1.add(c2);</span><br><span class="line">    c1.printA(); <span class="comment">// a: 3</span></span><br><span class="line">    c2.printA(); <span class="comment">// a: 2</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="友元函数"><a href="#友元函数" class="headerlink" title="友元函数"></a>友元函数</h3><blockquote>
<p>通过friend申明为友元方法, 可以使用外部函数直接修改类的私有变量</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C1</span> &#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">friend</span> <span class="keyword">void</span> <span class="title">modifyA</span><span class="params">(C1 &amp;c, <span class="keyword">int</span> _a)</span></span>;</span><br><span class="line">    C1(<span class="keyword">int</span> a = <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;a = a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">C1&amp; <span class="title">add</span><span class="params">(C1 c2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;a = <span class="keyword">this</span>-&gt;a + c2.a;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">" a: "</span> &lt;&lt; <span class="keyword">this</span>-&gt;a &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">modifyA</span><span class="params">(C1 &amp;c, <span class="keyword">int</span> _a)</span> </span>&#123;</span><br><span class="line">    c.a = _a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    <span class="function">C1 <span class="title">c1</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">    c1.printA();</span><br><span class="line">    modifyA(c1, <span class="number">100</span>);</span><br><span class="line">    c1.printA();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="友元类"><a href="#友元类" class="headerlink" title="友元类"></a>友元类</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C1</span> &#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">friend</span> <span class="class"><span class="keyword">class</span> <span class="title">C2</span>;</span></span><br><span class="line">    C1(<span class="keyword">int</span> a = <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;a = a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">C1&amp; <span class="title">add</span><span class="params">(C1 c2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;a = <span class="keyword">this</span>-&gt;a + c2.a;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">" a: "</span> &lt;&lt; <span class="keyword">this</span>-&gt;a &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C2</span> &#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    C1 c;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setC1A</span><span class="params">(<span class="keyword">int</span> _a)</span> </span>&#123;</span><br><span class="line">        c.a = _a;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">" a: "</span> &lt;&lt; c.a &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    C2 c2;</span><br><span class="line">    c2.printA();</span><br><span class="line">    c2.setC1A(<span class="number">100</span>);</span><br><span class="line">    c2.printA();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="类的重载"><a href="#类的重载" class="headerlink" title="类的重载"></a>类的重载</h2><blockquote>
<p>重载必须发生在同一类中, 继承的同名方法只会覆盖重写, 不能发生重载</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Human</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">introduce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">" I am Human"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">echo</span><span class="params">(<span class="keyword">char</span>* p, <span class="keyword">int</span> a)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"echo: "</span> &lt;&lt; p &lt;&lt; <span class="string">" a: "</span> &lt;&lt; a &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">virtual</span> ~Human() &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"Human 析构函数"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Man</span> :</span> <span class="keyword">public</span> Human &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">introduce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">" I am Man "</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">echo</span><span class="params">(<span class="keyword">char</span>* p)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"echo: "</span> &lt;&lt; p &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ~Man() &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"Man 析构函数"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Woman</span> :</span> <span class="keyword">public</span> Human &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">introduce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">" I am Human "</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ~Woman() &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"Woman 析构函数"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    Human *human = <span class="literal">NULL</span>;</span><br><span class="line">    Man man = Man();</span><br><span class="line">    Woman woman = Woman();</span><br><span class="line">    human = &amp;man;</span><br><span class="line">    </span><br><span class="line">    man.echo(<span class="string">"hello"</span>);</span><br><span class="line">    man.Human::echo(<span class="string">"hello"</span>, <span class="number">1</span>);<span class="comment">//无法直接调用man.echo("hello", 1)</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="类的操作符重载"><a href="#类的操作符重载" class="headerlink" title="类的操作符重载"></a>类的操作符重载</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C3</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span>* arr;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//因为是私有变量所以需要将全局函数声明为友元函数</span></span><br><span class="line">    <span class="keyword">friend</span> C3 <span class="keyword">operator</span>+(C3 &amp;c1, C3 &amp;c2);</span><br><span class="line">    <span class="keyword">friend</span> C3 <span class="keyword">operator</span>++(C3 &amp;c1, <span class="keyword">int</span>);</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    C3(<span class="keyword">int</span> a) &#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;a = a;</span><br><span class="line">        <span class="keyword">this</span>-&gt;arr = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">100</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"a: "</span> &lt;&lt; <span class="keyword">this</span>-&gt;a &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//第一种 用类方法声明</span></span><br><span class="line">    C3 <span class="keyword">operator</span>-(C3 &amp;c2) &#123;</span><br><span class="line">        <span class="function">C3 <span class="title">tmp</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">        tmp.a = <span class="keyword">this</span>-&gt;a - c2.a;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//一元操作符重载</span></span><br><span class="line">    C3&amp; <span class="keyword">operator</span>++() &#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;a++;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//后置--</span></span><br><span class="line">    C3 <span class="keyword">operator</span>--(<span class="keyword">int</span>) &#123;</span><br><span class="line">        C3 tmp = *<span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">this</span>-&gt;a--;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> tmp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span>&amp; <span class="keyword">operator</span>[](<span class="keyword">int</span> i) &#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;arr[i] = i;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//第二种 使用全局函数声明</span></span><br><span class="line">C3 <span class="keyword">operator</span>+(C3 &amp;c1, C3 &amp;c2) &#123;</span><br><span class="line">    <span class="function">C3 <span class="title">tmp</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">    tmp.a = c1.a + c2.a;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> tmp;</span><br><span class="line">&#125;</span><br><span class="line">C3 <span class="keyword">operator</span>++(C3 &amp;c1, <span class="keyword">int</span>)&#123;</span><br><span class="line">    C3 tmp = c1;</span><br><span class="line">    c1.a ++;</span><br><span class="line">    <span class="keyword">return</span> tmp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    C3 c1(1), c2(2);</span><br><span class="line"></span><br><span class="line">    C3 c3 = c1 + c2;</span><br><span class="line">    c3.printA();</span><br><span class="line">    C3 c4 = c1 - c2;</span><br><span class="line">    c4.printA();</span><br><span class="line">    ++c4;</span><br><span class="line">    c4.printA();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line">        c4[i] = i;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; c4[i] &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="类继承"><a href="#类继承" class="headerlink" title="类继承"></a>类继承</h2><p>类继承也有三种修饰符public, protected, private</p>
<ul>
<li>public继承, 就是默认继承</li>
<li>protected继承, public属性和方法都会变成protected</li>
<li>private继承, public, protected属性和方法都会变成private<h3 id="属性的重写"><a href="#属性的重写" class="headerlink" title="属性的重写"></a>属性的重写</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="keyword">int</span> b;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> c;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"a: "</span> &lt;&lt; a &lt;&lt; <span class="string">" b:"</span> &lt;&lt; b &lt;&lt; <span class="string">" c:"</span> &lt;&lt; c &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Son</span> :</span> <span class="keyword">public</span> Parent&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> b;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printAll2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"a: "</span> &lt;&lt; a &lt;&lt; <span class="string">" b:"</span> &lt;&lt; b  &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    Son s1;</span><br><span class="line">    s1.a = <span class="number">1</span>;</span><br><span class="line">    s1.b = <span class="number">2</span>;</span><br><span class="line">    s1.Parent::a = <span class="number">2</span>;</span><br><span class="line">    s1.printAll(); <span class="comment">//a: 2 b:0 c:0</span></span><br><span class="line">    s1.printAll2(); <span class="comment">//a: 1 b:2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="继承的构造方法和析构方法执行顺序"><a href="#继承的构造方法和析构方法执行顺序" class="headerlink" title="继承的构造方法和析构方法执行顺序"></a>继承的构造方法和析构方法执行顺序</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Object</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> o1;</span><br><span class="line">    <span class="keyword">int</span> o2;</span><br><span class="line">    Object(<span class="keyword">int</span> o1, <span class="keyword">int</span> o2) &#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;o1 = o1;</span><br><span class="line">        <span class="keyword">this</span>-&gt;o2 = o2;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"Object 构造方法:  o1: "</span> &lt;&lt; o1 &lt;&lt; <span class="string">" o2: "</span> &lt;&lt; o2 &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ~Object() &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"Object 析构方法:  o1: "</span> &lt;&lt; o1 &lt;&lt; <span class="string">" o2: "</span> &lt;&lt; o2 &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span>:</span> <span class="keyword">public</span> Object &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="keyword">int</span> b;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> c;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    Parent(<span class="keyword">int</span> a, <span class="keyword">int</span> b) : Object(a + <span class="number">1</span>, b + <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;a = a;</span><br><span class="line">        <span class="keyword">this</span>-&gt;b = b;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"Parent 构造方法:  a: "</span> &lt;&lt; a &lt;&lt; <span class="string">" b: "</span> &lt;&lt; b &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ~Parent() &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"Parent 析构方法:  a: "</span> &lt;&lt; a &lt;&lt; <span class="string">" b: "</span> &lt;&lt; b &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"a: "</span> &lt;&lt; a &lt;&lt; <span class="string">" b:"</span> &lt;&lt; b &lt;&lt; <span class="string">" c:"</span> &lt;&lt; c &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Son</span> :</span> <span class="keyword">public</span> Parent&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> b;</span><br><span class="line">    Object o1;</span><br><span class="line">    Object o2;</span><br><span class="line">    Son(<span class="keyword">int</span> a, <span class="keyword">int</span> b) : o2(a, <span class="number">2</span>), Parent(a+<span class="number">1</span>, b + <span class="number">1</span>), o1(a, b) &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"Son 构造方法:  a: "</span> &lt;&lt; a &lt;&lt; <span class="string">" b: "</span> &lt;&lt; b &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ~Son() &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"Son 析构方法"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printAll2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"a: "</span> &lt;&lt; a &lt;&lt; <span class="string">" b:"</span> &lt;&lt; b  &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    <span class="function">Son <span class="title">s1</span><span class="params">(<span class="number">1</span>, <span class="number">2</span>)</span></span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     Object 构造方法:  o1: 3 o2: 4</span></span><br><span class="line"><span class="comment">    Parent 构造方法:  a: 2 b: 3</span></span><br><span class="line"><span class="comment">    Object 构造方法:  o1: 1 o2: 2</span></span><br><span class="line"><span class="comment">    Object 构造方法:  o1: 1 o2: 2</span></span><br><span class="line"><span class="comment">    Son 构造方法:  a: 1 b: 2</span></span><br><span class="line"><span class="comment">    Son 析构方法</span></span><br><span class="line"><span class="comment">    Object 析构方法:  o1: 1 o2: 2</span></span><br><span class="line"><span class="comment">    Object 析构方法:  o1: 1 o2: 2</span></span><br><span class="line"><span class="comment">    Parent 析构方法:  a: 2 b: 3</span></span><br><span class="line"><span class="comment">    Object 析构方法:  o1: 3 o2: 4</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="虚继承与继承二义性"><a href="#虚继承与继承二义性" class="headerlink" title="虚继承与继承二义性"></a>虚继承与继承二义性</h3><blockquote>
<p>如下, B1与B2都继承了A, C又同时继承了B1和B2, 这样就产生了二义性,<br>为了防止产生二义性应该给B1, B2添加virtual, 表示虚继承, 这样A的构造函数只会被执行一次,<br>虚继承会给类多加了8字节的数据;<br>如果在2个类中出现同样名称的变量, 只能通过 <code>obj.class::var</code>的方式来解决二义性</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">cclass A &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    A() &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"I am A"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B1</span> :</span> <span class="keyword">virtual</span> <span class="keyword">public</span> A &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> b;</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B2</span> :</span> <span class="keyword">virtual</span> <span class="keyword">public</span> A &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C4</span>:</span> <span class="keyword">public</span> B1, <span class="keyword">public</span> B2 &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> c;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    C4 c;</span><br><span class="line">    c.a = <span class="number">1</span>;</span><br><span class="line">    c.B1::b = <span class="number">2</span>;</span><br><span class="line">    c.B2::b = <span class="number">3</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"sizeof(A): "</span> &lt;&lt; <span class="keyword">sizeof</span>(A) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"sizeof(B1): "</span> &lt;&lt; <span class="keyword">sizeof</span>(B1) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"sizeof(B2): "</span> &lt;&lt; <span class="keyword">sizeof</span>(B2) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"sizeof(C4): "</span> &lt;&lt; <span class="keyword">sizeof</span>(C4) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    I am A</span></span><br><span class="line"><span class="comment">    sizeof(A): 4</span></span><br><span class="line"><span class="comment">    sizeof(B1): 16</span></span><br><span class="line"><span class="comment">    sizeof(B2): 16</span></span><br><span class="line"><span class="comment">    sizeof(C4): 40</span></span><br><span class="line"><span class="comment">    /*</span></span><br><span class="line"><span class="comment">    return 0;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="多态"><a href="#多态" class="headerlink" title="多态"></a>多态</h2><blockquote>
<p>想让方法实现多态, 必须给方法添加上virtual, 否则使用多态调用时, 只会调用父类的方法, 而不是自己的方法;<br>没加virtual, 是静态联编, 就是说调用哪个方法, 在编译阶段已经确定;<br>加了virtual, 是动态联编, 就是说调用哪个方法, 只调用的时候的确定</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Human</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">introduce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">" I am Human"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Man</span> :</span> <span class="keyword">public</span> Human &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">introduce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">" I am Man "</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Woman</span> :</span> <span class="keyword">public</span> Human &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">introduce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">" I am Human "</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">introduce</span><span class="params">(Human *p)</span> </span>&#123;</span><br><span class="line">    p-&gt;introduce();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    Human *human = <span class="literal">NULL</span>;</span><br><span class="line">    Man man = Man();</span><br><span class="line">    Woman woman = Woman();</span><br><span class="line">    human = &amp;man;</span><br><span class="line">    </span><br><span class="line">    introduce(&amp;man);</span><br><span class="line">    introduce(&amp;woman);</span><br><span class="line">    introduce(human);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="用函数指针实现多态"><a href="#用函数指针实现多态" class="headerlink" title="用函数指针实现多态"></a>用函数指针实现多态</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//第一种</span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*myFunc)</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line"><span class="comment">//void likeMultiPoly(myFunc p, int a, int b) &#123;</span></span><br><span class="line"><span class="comment">// 第二种</span></span><br><span class="line">void likeMultiPoly(void (*p)(int a, int b) , int a, int b) &#123;</span><br><span class="line">    p(a, b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func2</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"func2 a: %d, b: %d\n"</span>, a, b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func3</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"func3 a: %d, b: %d\n"</span>, a, b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func4</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"func4 a: %d, b: %d\n"</span>, a, b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    likeMultiPoly(func2, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    likeMultiPoly(func3, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">    likeMultiPoly(func4, <span class="number">5</span>, <span class="number">6</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="虚析构函数"><a href="#虚析构函数" class="headerlink" title="虚析构函数"></a>虚析构函数</h3><blockquote>
<p>如果通过多态的方式, 释放对象内存, 必须给析构函数加上vitrual, 否则只会调用父类的析构函数, 子类的析构函数不会被调用, 而导致内存溢出</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Human</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">introduce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">" I am Human"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">virtual</span> ~Human() &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"Human 析构函数"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Man</span> :</span> <span class="keyword">public</span> Human &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">introduce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">" I am Man "</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ~Man() &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"Man 析构函数"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Woman</span> :</span> <span class="keyword">public</span> Human &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">introduce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">" I am Human "</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ~Woman() &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"Woman 析构函数"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">introduce</span><span class="params">(Human *p)</span> </span>&#123;</span><br><span class="line">    p-&gt;introduce();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">deleteHuman</span><span class="params">(Human *p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">delete</span> p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    Human *human = <span class="literal">NULL</span>;</span><br><span class="line">    Man man = Man();</span><br><span class="line">    Woman woman = Woman();</span><br><span class="line">    human = &amp;man;</span><br><span class="line">    </span><br><span class="line">    introduce(&amp;man);</span><br><span class="line">    introduce(&amp;woman);</span><br><span class="line">    introduce(human);</span><br><span class="line">    </span><br><span class="line">    Human *man2 = <span class="keyword">new</span> Man();</span><br><span class="line">    deleteHuman(man2);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"=========="</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="vptr-指针"><a href="#vptr-指针" class="headerlink" title="vptr 指针"></a>vptr 指针</h3><blockquote>
<p>cpp的多态是使用vptr指针实现的, 即每个类都会生成一份虚函数映射表, 然后把虚函数放入, 然后通过vptr指针获取对应的虚函数</p>
</blockquote>
<h4 id="子类的vptr指针是分步初始化的"><a href="#子类的vptr指针是分步初始化的" class="headerlink" title="子类的vptr指针是分步初始化的"></a>子类的vptr指针是分步初始化的</h4><blockquote>
<p>子类的vptr指针是在构造函数执行完毕后才初始化完成的</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    Parent() &#123;</span><br><span class="line">        print();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"I am Parent"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Son</span> :</span> <span class="keyword">public</span> Parent &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    Son() &#123;</span><br><span class="line">        print();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"I am Son"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    Son s1;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * I am Parent</span></span><br><span class="line"><span class="comment">     * I am Son</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="纯虚函数-gt-抽象函数"><a href="#纯虚函数-gt-抽象函数" class="headerlink" title="纯虚函数 -&gt; 抽象函数"></a>纯虚函数 -&gt; 抽象函数</h2><blockquote>
<p>cpp中的接口是用纯虚函数+多继承实现的</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">interface1</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">interface2</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">echo</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Human</span> :</span> <span class="keyword">public</span> interface1, <span class="keyword">public</span> interface2 &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"I am running"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">echo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"hello world"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"I like delicious foods"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pig</span> :</span> <span class="keyword">public</span> interface1 &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"I am running"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">echo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"gu gu gu"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"I like any food"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> :</span> <span class="keyword">public</span> interface2 &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"I am running"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">echo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"Wang Wang Wang"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">doSomething</span><span class="params">(interface1* inter)</span> </span>&#123;</span><br><span class="line">    inter-&gt;run();</span><br><span class="line">    inter-&gt;eat();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">doSomething2</span><span class="params">(interface2* inter)</span> </span>&#123;</span><br><span class="line">    inter-&gt;run();</span><br><span class="line">    inter-&gt;echo();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    Human h1;</span><br><span class="line">    Pig p1;</span><br><span class="line">    Dog d1;</span><br><span class="line">    doSomething(&amp;h1);</span><br><span class="line">    doSomething(&amp;p1);</span><br><span class="line">    doSomething2(&amp;h1);</span><br><span class="line">    doSomething2(&amp;d1);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.hellolc.com/2018/02/23/cpp/" data-id="cl6xk2y7y0021c65wq2xuizs0" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-c提高" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/02/11/c提高/" class="article-date">
  <time datetime="2018-02-11T15:14:28.000Z" itemprop="datePublished">2018-02-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/02/11/c提高/">C提高</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="内存四区"><a href="#内存四区" class="headerlink" title="内存四区"></a>内存四区</h2><ul>
<li>栈区: 由编译器自动分配释放, 主要存放函数的参数值, 局部变量的值, 遵循先进后出原则</li>
<li>堆区: 程序猿malloc申请的内存存放区域</li>
<li>全局区: 存放全局变量和静态变量, 常量, 比如字符串常量</li>
<li>代码区: 存放函数体二进制代码</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> gl = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> a = <span class="string">'a'</span>;</span><br><span class="line">    <span class="keyword">char</span> b = <span class="string">'b'</span>;</span><br><span class="line">    <span class="keyword">int</span> c = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">char</span> *p = <span class="string">"aaaa"</span>;</span><br><span class="line">    <span class="keyword">char</span> *p2 = (<span class="keyword">char</span>*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">char</span>) * <span class="number">100</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"a: %d , b: %d, c: %d, &amp;p: %d, &amp;p2: %d, p: %d, p2: %d, gl: %d\n"</span>, &amp;a, &amp;b, &amp;c, &amp;p, &amp;p2, p, p2, &amp;gl);</span><br><span class="line">    <span class="comment">//a: 1606416119 , b: 1606416118, c: 1606416112, &amp;p: 1606416104, &amp;p2: 1606416096, p: 7887, p2: 3186800, gl: 8436</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span>* <span class="title">getStr1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *p = <span class="string">"hello"</span>;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">char</span>* <span class="title">getStr2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *p = <span class="string">"hello"</span>;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *p1 = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">char</span> *p2 = <span class="literal">NULL</span>;</span><br><span class="line">    p1 = getStr1();</span><br><span class="line">    p2 = getStr2();</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"p1: %d, p2: %d\n"</span>, p1, p2);</span><br><span class="line">    <span class="comment">//p1: 3936, p2: 3943</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="memset-lt-void-b-gt-lt-int-c-gt-lt-size-t-len-gt"><a href="#memset-lt-void-b-gt-lt-int-c-gt-lt-size-t-len-gt" class="headerlink" title="memset(&lt;#void *b#&gt;, &lt;#int c#&gt;, &lt;#size_t __len#&gt;)"></a>memset(&lt;#void *<strong>b#&gt;, &lt;#int </strong>c#&gt;, &lt;#size_t __len#&gt;)</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> buff[<span class="number">100</span>];</span><br><span class="line"><span class="comment">//刚申请的内存地址, 里面也许有脏数据, 可以通过memset初始化</span></span><br><span class="line"><span class="built_in">memset</span>(buff, <span class="number">0</span>, <span class="keyword">sizeof</span>(buff));</span><br></pre></td></tr></table></figure>
<h2 id="指针"><a href="#指针" class="headerlink" title="指针"></a>指针</h2><h3 id="arr-1-与-amp-arr-1的区别"><a href="#arr-1-与-amp-arr-1的区别" class="headerlink" title="arr + 1 与 &amp;arr + 1的区别"></a>arr + 1 与 &amp;arr + 1的区别</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> arr[<span class="number">10</span>];</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"arr: %d, arr+1: %d, &amp;arr: %d, $arr+1: %d"</span>, arr, arr + <span class="number">1</span>, &amp;arr, &amp;arr + <span class="number">1</span>); </span><br><span class="line"><span class="comment">//arr: 1606416032, arr+1: 1606416036, &amp;arr: 1606416032, $arr+1: 1606416072</span></span><br><span class="line"><span class="comment">//从上可知 arr+1会增加4字节, &amp;arr+1会增加40字节, 及跳过数组的大小</span></span><br></pre></td></tr></table></figure>
<h3 id="const-char-p-与-char-const-p-的区别"><a href="#const-char-p-与-char-const-p-的区别" class="headerlink" title="const char p 与 char const p 的区别"></a>const char<em> p 与 char</em> const p 的区别</h3><blockquote>
<p>const char<em>p 表示指针指针的内容不能修改<br>char</em> const p 表示指针不能被修改<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testConst</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* p)</span> </span>&#123;</span><br><span class="line">    p[<span class="number">0</span>] = <span class="number">1</span>;<span class="comment">//报错</span></span><br><span class="line">    p = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testConst</span><span class="params">(<span class="keyword">char</span>* <span class="keyword">const</span> p)</span> </span>&#123;</span><br><span class="line">    p[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    p = <span class="number">1</span>;<span class="comment">//报错</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="3中二级指针模型"><a href="#3中二级指针模型" class="headerlink" title="3中二级指针模型"></a>3中二级指针模型</h3><h4 id="指针数组-第一种二级指针模型"><a href="#指针数组-第一种二级指针模型" class="headerlink" title="指针数组 第一种二级指针模型"></a>指针数组 第一种二级指针模型</h4><blockquote>
<p>数组中的每个元素是指针, 指针指向全局区里的字符串常量</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    <span class="comment">// insert code here...</span></span><br><span class="line">    <span class="keyword">char</span> * <span class="built_in">array</span>[] = &#123;<span class="string">"aaaa"</span>, <span class="string">"bbbb"</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> len = <span class="keyword">sizeof</span>(<span class="built_in">array</span>) / <span class="keyword">sizeof</span>(<span class="built_in">array</span>[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i ++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"array[i] = %s\n"</span>, <span class="built_in">array</span>[i]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"*(array+i) = %s\n\n"</span>, *(<span class="built_in">array</span>+i));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="第二种二级指针模型"><a href="#第二种二级指针模型" class="headerlink" title="第二种二级指针模型"></a>第二种二级指针模型</h4><blockquote>
<p>所有数据都存放在栈区, array步长为4</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> <span class="built_in">array</span>[<span class="number">3</span>][<span class="number">5</span>] = &#123;<span class="string">"aaaa"</span>, <span class="string">"bbbb"</span>, <span class="string">"cccc"</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">       <span class="built_in">printf</span>(<span class="string">"%d-%s \n"</span>, i, <span class="built_in">array</span>[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="第三种二级指针模型"><a href="#第三种二级指针模型" class="headerlink" title="第三种二级指针模型"></a>第三种二级指针模型</h4><blockquote>
<p>数据都存放在堆区</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span>** p = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">int</span> num = <span class="number">5</span>;</span><br><span class="line">    p = (<span class="keyword">char</span>**)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">char</span>*)*num);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; num; i++) &#123;</span><br><span class="line">        *(p+i) = (<span class="keyword">char</span>*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">char</span>)*num);</span><br><span class="line">        <span class="built_in">sprintf</span>(p[i], <span class="string">"%d%d%d"</span>, i+<span class="number">1</span>, i+<span class="number">2</span>, i+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; num; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d-%s \n"</span>, i, p[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="数组类型指针"><a href="#数组类型指针" class="headerlink" title="数组类型指针"></a>数组类型指针</h3><h4 id="第一种"><a href="#第一种" class="headerlink" title="第一种"></a>第一种</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    <span class="comment">// insert code here...</span></span><br><span class="line">    typedef int (myArray)[5];//定义了一个数组类型</span><br><span class="line">    <span class="comment">//myArray arr; //int arr[5];</span></span><br><span class="line">    myArray* p = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">int</span> arr[<span class="number">5</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line">        arr[i] = i + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    p = &amp;arr;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"(*p)[%d]: %d\n"</span>, i, (*p)[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="第二种"><a href="#第二种" class="headerlink" title="第二种"></a>第二种</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    typedef int (*arrayTypeP)[5];</span><br><span class="line">    arrayTypeP p = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">int</span> arr[<span class="number">5</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line">        arr[i] = i + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    p = &amp;arr;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"(*p)[%d]: %d\n"</span>, i, (*p)[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="第三种"><a href="#第三种" class="headerlink" title="第三种"></a>第三种</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> (*p)[<span class="number">5</span>];</span><br><span class="line">    <span class="keyword">int</span> arr[<span class="number">5</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line">        arr[i] = i + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    p = &amp;arr;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"(*p)[%d]: %d\n"</span>, i, (*p)[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="函数指针"><a href="#函数指针" class="headerlink" title="函数指针"></a>函数指针</h3><blockquote>
<p>用函数指针实现多态<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//第一种</span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*myFunc)</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line"><span class="comment">//void likeMultiPoly(myFunc p, int a, int b) &#123;</span></span><br><span class="line"><span class="comment">// 第二种</span></span><br><span class="line">void likeMultiPoly(void (*p)(int a, int b) , int a, int b) &#123;</span><br><span class="line">    p(a, b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func2</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"func2 a: %d, b: %d\n"</span>, a, b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func3</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"func3 a: %d, b: %d\n"</span>, a, b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func4</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"func4 a: %d, b: %d\n"</span>, a, b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    likeMultiPoly(func2, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    likeMultiPoly(func3, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">    likeMultiPoly(func4, <span class="number">5</span>, <span class="number">6</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h2><blockquote>
<p>一旦定义好结构体, 其对应的内存也分配完毕, 可以根据偏移量算出各变量的地址, 一旦声明完毕, 就不要轻易修改变量位置</p>
<h3 id="结构体的定义"><a href="#结构体的定义" class="headerlink" title="结构体的定义"></a>结构体的定义</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Teacher</span> &#123;</span></span><br><span class="line">    <span class="keyword">char</span> name[<span class="number">32</span>];</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line">&#125;;<span class="comment">//struct Teacher tearch;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Teacher2</span> &#123;</span></span><br><span class="line">    <span class="keyword">char</span> name[<span class="number">32</span>];</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line">&#125;t;<span class="comment">// t tearch;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Student</span> &#123;</span></span><br><span class="line">    <span class="keyword">char</span> name[<span class="number">32</span>];</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line">&#125;s1, s2;<span class="comment">//定义类型 同时定义变量</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">char</span> name[<span class="number">32</span>];</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line">&#125;s3 = &#123;<span class="string">"s3"</span>, <span class="number">18</span>&#125;;<span class="comment">//定义匿名类型 同时定义变量</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[], <span class="keyword">char</span> ** env)</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Teacher</span> <span class="title">t1</span> = &#123;</span><span class="string">"t1"</span>, <span class="number">18</span>&#125;;</span><br><span class="line">    t t2 = &#123;<span class="string">"t2"</span>, <span class="number">18</span>&#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="结构体的操作"><a href="#结构体的操作" class="headerlink" title="结构体的操作"></a>结构体的操作</h3><blockquote>
<p>t1.age t-&gt;age <code>.</code>和<code>-&gt;</code> 没有操作内存, 都是在cpu中, 相对于t1进行偏移量寻址操作</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[], <span class="keyword">char</span> ** env)</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Teacher</span> <span class="title">t1</span> = &#123;</span><span class="string">"t1"</span>, <span class="number">18</span>&#125;;</span><br><span class="line">    t t2 = &#123;<span class="string">"t2"</span>, <span class="number">18</span>&#125;;</span><br><span class="line">    t* p = <span class="literal">NULL</span>;</span><br><span class="line">    p = &amp;t2;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"t2.age: %d\n"</span>, t2.age);</span><br><span class="line">    </span><br><span class="line">    p-&gt;age = <span class="number">20</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"t2.age: %d\n"</span>, t2.age);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"p-&gt;name: %s\n"</span>, p-&gt;name);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><h3 id="数组首地址与数组地址的区别"><a href="#数组首地址与数组地址的区别" class="headerlink" title="数组首地址与数组地址的区别?"></a>数组首地址与数组地址的区别?</h3><blockquote>
<p>c是数组的首元素的地址 c+1 步长为4字节<br>&amp;c是数组的地址 &amp;c+1 步长为200*4字节</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> c[<span class="number">200</span>] = &#123;<span class="number">0</span>&#125;;<span class="comment">//编译时将所有的值设置为0</span></span><br><span class="line">    <span class="built_in">memset</span>(c, <span class="number">0</span>, <span class="keyword">sizeof</span>(c));<span class="comment">//运行时, 显示的将所有的值设置为0</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"c =&gt; %d \n c+1 =&gt; %d \n &amp;c =&gt; %d \n &amp;c+1 =&gt; %d "</span>, c, c+<span class="number">1</span>, &amp;c, &amp;c+<span class="number">1</span>);</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">        c =&gt; 1606415264 </span></span><br><span class="line"><span class="comment">        c+1 =&gt; 1606415268 </span></span><br><span class="line"><span class="comment">        &amp;c =&gt; 1606415264 </span></span><br><span class="line"><span class="comment">        &amp;c+1 =&gt; 1606416064</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="定义数组类型"><a href="#定义数组类型" class="headerlink" title="定义数组类型"></a>定义数组类型</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    <span class="comment">// insert code here...</span></span><br><span class="line">    typedef int (myArray)[5];//定义了一个数组类型</span><br><span class="line">    myArray arr; <span class="comment">//int arr[5];</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="程序默认参数"><a href="#程序默认参数" class="headerlink" title="程序默认参数"></a>程序默认参数</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[], <span class="keyword">char</span> ** env)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//传递参数个数</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"argc: %d\n"</span>, argc);</span><br><span class="line">    <span class="comment">//调用程序是 传递是参数, 默认会传递文件路径</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; argc; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, argv[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//打印环境变量</span></span><br><span class="line">    <span class="keyword">while</span> (*env ++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, *env);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="字符串结束标志"><a href="#字符串结束标志" class="headerlink" title="字符串结束标志"></a>字符串结束标志</h3><blockquote>
<p>字符串结束标志位 ‘\0’, NULL, 0<br>本质就是0</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.hellolc.com/2018/02/11/c提高/" data-id="cl6xk2y800024c65waj1wof7e" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-ModelsAndData" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/02/03/ModelsAndData/" class="article-date">
  <time datetime="2018-02-03T07:05:14.000Z" itemprop="datePublished">2018-02-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/02/03/ModelsAndData/">Models And Data</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="ORM"><a href="#ORM" class="headerlink" title="ORM"></a>ORM</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Math</span>.guid = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'</span>.replace(<span class="regexp">/[xy]/g</span>, <span class="function"><span class="keyword">function</span>(<span class="params">c</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> r = <span class="built_in">Math</span>.random()*<span class="number">16</span>|<span class="number">0</span>, v = c == <span class="string">'x'</span> ? r : (r&amp;<span class="number">0x3</span>|<span class="number">0x8</span>);</span><br><span class="line">        <span class="keyword">return</span> v.toString(<span class="number">16</span>); </span><br><span class="line">    &#125;).toUpperCase();</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> Model = &#123;</span><br><span class="line">    <span class="comment">//记录实例对象</span></span><br><span class="line">    records: &#123;&#125;,</span><br><span class="line">    inherited: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,</span><br><span class="line">    created: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//让records不共享</span></span><br><span class="line">        <span class="keyword">this</span>.records = &#123;&#125;; </span><br><span class="line">    &#125;,</span><br><span class="line">    find: <span class="function"><span class="keyword">function</span>(<span class="params">id</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> record = <span class="keyword">this</span>.records[id];</span><br><span class="line">        <span class="keyword">if</span> ( !record ) <span class="keyword">throw</span>(<span class="string">"Unknown record"</span>); </span><br><span class="line">        <span class="comment">//每次返回都重新复制一个对象 防止修改影响到records里的数据</span></span><br><span class="line">        <span class="keyword">return</span> record.dup();</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//实例所具有的方法</span></span><br><span class="line">    prototype: &#123;</span><br><span class="line">        newRecord: <span class="literal">true</span>,</span><br><span class="line">        init: <span class="function"><span class="keyword">function</span>(<span class="params">atts</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (atts) <span class="keyword">this</span>.load(atts);</span><br><span class="line">        &#125;,</span><br><span class="line">        load: <span class="function"><span class="keyword">function</span>(<span class="params">attributes</span>)</span>&#123; </span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> name <span class="keyword">in</span> attributes)</span><br><span class="line">                <span class="keyword">this</span>[name] = attributes[name]; </span><br><span class="line">        &#125;,</span><br><span class="line">        create: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> ( !<span class="keyword">this</span>.id ) <span class="keyword">this</span>.id = <span class="built_in">Math</span>.guid(); </span><br><span class="line">            <span class="keyword">this</span>.newRecord = <span class="literal">false</span>; </span><br><span class="line">            <span class="keyword">this</span>.parent.records[<span class="keyword">this</span>.id] = <span class="keyword">this</span>.dup();</span><br><span class="line">        &#125;,</span><br><span class="line">        dup: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> $.extend(<span class="literal">true</span>, &#123;&#125;, <span class="keyword">this</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        destroy: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">delete</span> <span class="keyword">this</span>.parent.records[<span class="keyword">this</span>.id];</span><br><span class="line">        &#125;,</span><br><span class="line">        update: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.parent.records[<span class="keyword">this</span>.id] = <span class="keyword">this</span>.dup();</span><br><span class="line">        &#125;,</span><br><span class="line">        save: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.newRecord ? <span class="keyword">this</span>.create() : <span class="keyword">this</span>.update();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    create: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> object = <span class="built_in">Object</span>.create(<span class="keyword">this</span>);</span><br><span class="line">        object.parent = <span class="keyword">this</span>;</span><br><span class="line">        object.prototype = object.fn = <span class="built_in">Object</span>.create(<span class="keyword">this</span>.prototype);</span><br><span class="line">        object.created(); </span><br><span class="line">        <span class="keyword">this</span>.inherited(object); </span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;,</span><br><span class="line">    init: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> instance = <span class="built_in">Object</span>.create(<span class="keyword">this</span>.prototype); </span><br><span class="line">        instance.parent = <span class="keyword">this</span>; </span><br><span class="line">        <span class="comment">// console.log("init: ", instance.init)</span></span><br><span class="line">        instance.init.apply(instance, <span class="built_in">arguments</span>); </span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;,</span><br><span class="line">    include: <span class="function"><span class="keyword">function</span>(<span class="params">o</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> included = o.included; </span><br><span class="line">        $.extend(<span class="keyword">this</span>.prototype, o); </span><br><span class="line">        <span class="keyword">if</span> (included) included(<span class="keyword">this</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    extend: <span class="function"><span class="keyword">function</span>(<span class="params">o</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> extended = o.extended; </span><br><span class="line">        $.extend(<span class="keyword">this</span>, o);</span><br><span class="line">        <span class="keyword">if</span> (extended) extended(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取一个User model</span></span><br><span class="line"><span class="keyword">var</span> User = Model.create();</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取一个user1实例</span></span><br><span class="line"><span class="keyword">var</span> user1 = User.init();</span><br><span class="line">user1.id = <span class="number">1</span>;</span><br><span class="line">user1.name = <span class="string">'hello'</span>;</span><br><span class="line">user1.save();</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取一个user2实例</span></span><br><span class="line"><span class="keyword">var</span> user2 = User.init(&#123;</span><br><span class="line">    id: <span class="number">2</span>,</span><br><span class="line">    name: <span class="string">'world'</span>,</span><br><span class="line">&#125;);</span><br><span class="line">user2.save();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Goods = Model.create();</span><br><span class="line"><span class="keyword">var</span> goods1 = Goods.init(&#123;</span><br><span class="line">    id:<span class="number">1</span>,</span><br><span class="line">    name: <span class="string">'computer'</span></span><br><span class="line">&#125;)</span><br><span class="line">goods1.save();</span><br><span class="line"><span class="keyword">var</span> goods2 = Goods.init(&#123;</span><br><span class="line">    id:<span class="number">2</span>,</span><br><span class="line">    name: <span class="string">'mobile'</span></span><br><span class="line">&#125;)</span><br><span class="line">goods2.save()</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.hellolc.com/2018/02/03/ModelsAndData/" data-id="cl6xk2y7k000vc65wamyj7gdl" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript-Web-Applications/">JavaScript Web Applications</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-3d变换" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/01/22/3d变换/" class="article-date">
  <time datetime="2018-01-22T14:41:55.000Z" itemprop="datePublished">2018-01-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/22/3d变换/">3d变换</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//以知半径r和角度phi, theta求x, y, z</span></span><br><span class="line"><span class="comment">// phi是方位面（水平面）内的角度，范围0~360度</span></span><br><span class="line"><span class="comment">// theta是俯仰面（竖直面）内的角度，范围0~180度</span></span><br><span class="line"><span class="comment">// 极坐标系的xyz 对应浏览器里 </span></span><br><span class="line"><span class="keyword">var</span> x = r * <span class="built_in">Math</span>.sin(theta) * <span class="built_in">Math</span>.sin(phi);</span><br><span class="line"><span class="keyword">var</span> y = r * <span class="built_in">Math</span>.cos(theta);</span><br><span class="line"><span class="keyword">var</span> z = r * <span class="built_in">Math</span>.sin(theta) * <span class="built_in">Math</span>.cos(phi);</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.hellolc.com/2018/01/22/3d变换/" data-id="cl6xk2y6o0000c65w9lx3isub" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-git" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/01/14/git/" class="article-date">
  <time datetime="2018-01-14T11:56:55.000Z" itemprop="datePublished">2018-01-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/14/git/">git</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">git difftool //使用对比工具</span><br><span class="line">git log -p -2//查看最近2次提交的详细信息</span><br><span class="line">git log -stat //可以看到变更的文件</span><br><span class="line">git log --since=2.weeks//2周内的日志</span><br><span class="line">git log --author zhichen//指定作者</span><br><span class="line">git log -S function_name //找出有对function_name的修改日志</span><br><span class="line">git remote -v//git 地址</span><br><span class="line">git push origin --tags//推送所有tag</span><br><span class="line">git branch -vv//查看各分支head情况</span><br><span class="line">git push origin --delete serverfix//删除线上分支</span><br><span class="line">git rebase master branchName; gitmerge branchName;//将branchName分支变基为master 在合并到master 这样功能和合并分支一样, 但是提交历史看起来像是线性开发而不是并行开发再合并的 </span><br><span class="line">git reset --hard HEAD; //取消本地操作 恢复成上一次提交记录</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.hellolc.com/2018/01/14/git/" data-id="cl6xk2y830029c65wybsn0r8e" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Pro-Git/">Pro Git</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-MVCAndClasses" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/01/14/MVCAndClasses/" class="article-date">
  <time datetime="2018-01-14T08:11:51.000Z" itemprop="datePublished">2018-01-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/14/MVCAndClasses/">MVCandClasses</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="What-Is-MVC"><a href="#What-Is-MVC" class="headerlink" title="What Is MVC?"></a>What Is MVC?</h2><h3 id="The-Model"><a href="#The-Model" class="headerlink" title="The Model"></a>The Model</h3><p>主要存储对象数据的地方</p>
<p>因为是面向对象编程, 因此我们任何数据被model对象封装后, 都可以直接调用其方法, 而不依赖全局方法, 这样可以减少很多全局方法冲突<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用全局变量的方法</span></span><br><span class="line"><span class="keyword">var</span> user = users[<span class="string">"foo"</span>]; </span><br><span class="line">destroyUser(user);</span><br><span class="line"></span><br><span class="line"><span class="comment">//建议封装为如下</span></span><br><span class="line"><span class="keyword">var</span> user = User.find(<span class="string">"foo"</span>); </span><br><span class="line">user.destroy();</span><br></pre></td></tr></table></figure></p>
<h3 id="The-View"><a href="#The-View" class="headerlink" title="The View"></a>The View</h3><p>主要是展示页面, 和其他逻辑解耦</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// helper.js</span></span><br><span class="line"><span class="keyword">var</span> helper = &#123;&#125;;</span><br><span class="line">helper.formatDate = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">/* ... */</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// template.html </span></span><br><span class="line">&lt;div&gt;</span><br><span class="line">    $&#123; helper.formatDate(<span class="keyword">this</span>.date) &#125; </span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="The-Controller"><a href="#The-Controller" class="headerlink" title="The Controller"></a>The Controller</h3><p>controller是model和view的中间粘合剂, 它从view中获取events和input, 再从model中获取相应数据, 返回给view展示</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Use a anonymous function to enscapulate scope </span></span><br><span class="line">(Controller.users = <span class="function"><span class="keyword">function</span>(<span class="params">$</span>)</span>&#123;</span><br><span class="line"><span class="keyword">var</span> nameClick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">    <span class="comment">/* ... */</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// Attach event listeners on page load $(function()&#123;</span></span><br><span class="line">$(<span class="string">"#view .name"</span>).click(nameClick); &#125;);</span><br><span class="line">&#125;)(jQuery);</span><br></pre></td></tr></table></figure>
<h2 id="Toward-Modularity-Creating-Classes"><a href="#Toward-Modularity-Creating-Classes" class="headerlink" title="Toward Modularity, Creating Classes"></a>Toward Modularity, Creating Classes</h2><p>js中的class是用原型链模拟的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Class = <span class="function"><span class="keyword">function</span>(<span class="params">parent</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> klass = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">this</span>.init.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (parent) &#123;</span><br><span class="line">          <span class="keyword">var</span> subClass = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">          subClass.prototype = parent.prototype;</span><br><span class="line">          klass.prototype = <span class="keyword">new</span> subClass();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      klass.fn = klass.prototype;</span><br><span class="line"></span><br><span class="line">      klass.fn.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">      klass.fn.parent = klass;</span><br><span class="line"></span><br><span class="line">      klass.fn._super = klass.__proto__;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Adding a proxy function </span></span><br><span class="line">      klass.proxy = <span class="function"><span class="keyword">function</span>(<span class="params">func</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> self = <span class="keyword">this</span>; </span><br><span class="line">        <span class="keyword">return</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> func.apply(self, <span class="built_in">arguments</span>); </span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// Add the function on instances too </span></span><br><span class="line">      klass.fn.proxy = klass.proxy;  </span><br><span class="line"></span><br><span class="line">      klass.extend = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> obj) &#123;</span><br><span class="line">              klass[i] = obj[i];</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      klass.include = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> obj) &#123;</span><br><span class="line">              klass.prototype[i] = obj[i];</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> klass;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> Animal = <span class="keyword">new</span> Class;</span><br><span class="line">Animal.include(&#123; </span><br><span class="line">    init: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'I am animal'</span>)  </span><br><span class="line">    &#125;,</span><br><span class="line">    breath: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'breath'</span>); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> animal = <span class="keyword">new</span> Animal;</span><br><span class="line">animal.breath(); <span class="comment">//I am animal //breath</span></span><br><span class="line"><span class="keyword">var</span> Cat = <span class="keyword">new</span> Class(Animal)</span><br><span class="line">Cat.prototype.init = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'I am Cat'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Usage</span></span><br><span class="line"><span class="keyword">var</span> tommy = <span class="keyword">new</span> Cat; </span><br><span class="line">tommy.breath();<span class="comment">//I am Cat //breath</span></span><br></pre></td></tr></table></figure>
<h3 id="bind-polyfill"><a href="#bind-polyfill" class="headerlink" title="bind polyfill"></a>bind polyfill</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="built_in">Function</span>.prototype.bind) &#123;</span><br><span class="line">    <span class="built_in">Function</span>.prototype.bind = <span class="function"><span class="keyword">function</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">        <span class="comment">//self 就是bind的调用者 context是调用者想绑定上下文</span></span><br><span class="line">        <span class="keyword">var</span> self = <span class="keyword">this</span>,</span><br><span class="line">            slice = [].prototype.slice,</span><br><span class="line">            <span class="comment">//获取额外要传递的参数</span></span><br><span class="line">            args = slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>),</span><br><span class="line">            <span class="comment">//用来做间接继承的</span></span><br><span class="line">            nop = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">        <span class="comment">//将bind的调用者的原型 赋值给nop</span></span><br><span class="line">        nop.prototype = self.prototype;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//bound 会覆盖bind调用者</span></span><br><span class="line">        <span class="keyword">var</span> bound = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="comment">//这里是函数被调用时 会生效的逻辑</span></span><br><span class="line">            <span class="comment">//通过apply将上下文 指向 nop(因为继承了bind调用者的原型)或者context</span></span><br><span class="line">            <span class="comment">//然后函数调用时传递的参数合并到之前传递进来的参数数组里</span></span><br><span class="line">            <span class="keyword">return</span> self.apply(<span class="keyword">this</span> <span class="keyword">instanceof</span> nop ? <span class="keyword">this</span> : (context || &#123;&#125;), args.concat(slice(<span class="built_in">arguments</span>)))</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//将bind调用者的原型赋值给bound的原型, 这样bound也拥有了bind调用者的属性和方法, 而且具有改变上下文指向的能力</span></span><br><span class="line">        bound.prototype = <span class="keyword">new</span> nop();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> bound;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.hellolc.com/2018/01/14/MVCAndClasses/" data-id="cl6xk2y7i000tc65w53emtx8y" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript-Web-Applications/">JavaScript Web Applications</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-node-js模块机制" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/01/13/node-js模块机制/" class="article-date">
  <time datetime="2018-01-13T07:53:23.000Z" itemprop="datePublished">2018-01-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/13/node-js模块机制/">node.js模块机制</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="模块编译"><a href="#模块编译" class="headerlink" title="模块编译"></a>模块编译</h2><p>module的定义<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Module</span>(<span class="params">id, parent</span>) </span>&#123; </span><br><span class="line">    <span class="keyword">this</span>.id = id;</span><br><span class="line">    <span class="keyword">this</span>.exports = &#123;&#125;; </span><br><span class="line">    <span class="keyword">this</span>.parent = parent;</span><br><span class="line">    <span class="keyword">if</span> (parent &amp;&amp; parent.children) &#123;</span><br><span class="line">         parent.children.push(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.filename = <span class="literal">null</span>; </span><br><span class="line">    <span class="keyword">this</span>.loaded = <span class="literal">false</span>; t</span><br><span class="line">    his.children = [];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> <span class="built_in">module</span> = <span class="keyword">new</span> Module()</span><br></pre></td></tr></table></figure></p>
<p>node会对引入的不同扩展类型的文件进行不同方式解析</p>
<ul>
<li>.js文件. 通过fs模块同步读取文件后编译执行</li>
<li>.node文件. 这是C/C++编写的扩展文件, 通过dlopen()方法加载最后编译生成的文件</li>
<li>.json文件. 通过JSON.parse获取结果</li>
<li>其他扩展类型. 它们都被当做js文件引入<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Module._extensions[<span class="string">'.json'</span>] = <span class="function"><span class="keyword">function</span>(<span class="params">module, filename</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> content = NativeModule.require(<span class="string">'fs'</span>).readFileSync(filename, <span class="string">'utf8'</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">module</span>.exports = <span class="built_in">JSON</span>.parse(stripBOM(content));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        err.message = filename + <span class="string">': '</span> + err.message;</span><br><span class="line">        <span class="keyword">throw</span> err;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//最后Module._extensions 会被赋值给require, 这样require可以在引入文件的时候, 根据不同类型进行解析</span></span><br><span class="line"><span class="built_in">require</span>.extensions = Module._extensions</span><br><span class="line"></span><br><span class="line"><span class="comment">//如果想对特殊的扩展进行处理, 可进行如下操作</span></span><br><span class="line"><span class="built_in">require</span>.extensions[<span class="string">'.ext'</span>] = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//...do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="node中的module-require等变量从何而来"><a href="#node中的module-require等变量从何而来" class="headerlink" title="node中的module, require等变量从何而来?"></a>node中的module, require等变量从何而来?</h3><p>其实node对获取数据通过字符的形式拼接如下, 然后再调用vm原生模块的<code>runInThisContext()</code>方法(类似eval, 只是具有明确的上下文, 不污染全局), 返回一个function对象, 最后将<code>exports, require, module, __filename, __dirname</code>通过参数传入, 这样每个模块就可以独立作用域了<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">exports, require, module, __filename, __dirname</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> math = <span class="built_in">require</span>(<span class="string">'math'</span>);</span><br><span class="line">    exports.area = <span class="function"><span class="keyword">function</span> (<span class="params">radius</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.PI * radius * radius; &#125;;</span><br><span class="line">&#125;)(exports, <span class="built_in">require</span>, <span class="built_in">module</span>, __filename, __dirname)</span><br></pre></td></tr></table></figure></p>
<h3 id="为什么需要同时传入exports和module"><a href="#为什么需要同时传入exports和module" class="headerlink" title="为什么需要同时传入exports和module?"></a>为什么需要同时传入exports和module?</h3><p>因为<code>exports = module.exports</code>, <code>exports</code>只是一个引用, 当赋值一个对象时, 这个引用就会被覆盖掉, 因此只能使用<code>module.exports</code></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.hellolc.com/2018/01/13/node-js模块机制/" data-id="cl6xk2y84002bc65wwqeuux19" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/深入浅出Node-js/">深入浅出Node.js</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-解读React源码" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/01/06/解读React源码/" class="article-date">
  <time datetime="2018-01-06T02:34:47.000Z" itemprop="datePublished">2018-01-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/06/解读React源码/">解读React源码</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="15-0版本源码结构"><a href="#15-0版本源码结构" class="headerlink" title="15.0版本源码结构"></a>15.0版本源码结构</h2><ul>
<li>addons:包含一系列的工具方法插件，如 PureRenderMixin、CSSTransitionGroup、Fragment、 LinkedStateMixin 等。</li>
<li>isomorphic:包含一系列同构方法</li>
<li>shared:包含一些公用或常用方法，如 Transaction、CallbackQueue 等</li>
<li>test:包含一些测试方法等</li>
<li>core/tests:包含一些边界错误的测试用例。</li>
<li>renderers:是 React 代码的核心部分，它包含了大部分功能实现，此处对其进行单独分析。<ul>
<li>renderers 分为 dom 和 shared 目录<ul>
<li>dom:包含 client、server 和 shared<ul>
<li>client:包含 DOM 操作方法(如 findDOMNode、setInnerHTML、setTextContent 等)以 及事件方法，结构如图 3-2 所示。这里的事件方法主要是一些非底层的实用性事件方法， 如 事 件 监 听 ( ReactEventListener )、 常 用 事 件 方 法 ( TapEventPlugin 、 EnterLeave- EventPlugin)以及一些合成事件(SyntheticEvents 等)。</li>
<li>server:主要包含服务端渲染的实现和方法(如 ReactServerRendering、ReactServer- RenderingTransaction 等)。</li>
<li>shared:包含文本组件(ReactDOMTextComponent)、标签组件(ReactDOMComponent)、 DOM 属性操作(DOMProperty、DOMPropertyOperations)、CSS 属性操作(CSSProperty、 CSSPropertyOperations)等。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>shared:包含 event 和 reconciler<ul>
<li>event:包含一些更为底层的事件方法，如事件插件中心(EventPluginHub)、事件注册(EventPluginRegistry)、事件传播(EventPropagators)以及一些事件通用方法。React 自定义了一套通用事件的插件系统，该系统包含事件监听器、事件发射器、事 件插件中心、点击事件、进/出事件、简单事件、合成事件以及一些事件方法，如图 3-3 所示。</li>
<li>reconciler:称为协调器，它是最为核心的部分，包含 React 中自定义组件的实现 (ReactCompositeComponent)、组件生命周期机制、setState 机制(ReactUpdates、ReactUpdateQueue)、DOM diff 算法(ReactMultiChild)等重要的特性方法。</li>
</ul>
</li>
</ul>
<h2 id="Virtual-DOM"><a href="#Virtual-DOM" class="headerlink" title="Virtual DOM"></a>Virtual DOM</h2><p>构建一套简易 Virtual DOM 模型并不复杂，它只需要具备一个 DOM 标签所需的基本 元素即可:</p>
<ul>
<li>标签名</li>
<li>节点属性，包含样式、属性、事件等</li>
<li>子节点</li>
<li>标识 id</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 标签名 </span></span><br><span class="line">    tagName: <span class="string">'div'</span>, </span><br><span class="line">    <span class="comment">// 属性 </span></span><br><span class="line">    properties: &#123;</span><br><span class="line">        <span class="comment">// 样式</span></span><br><span class="line">        style: &#123;&#125; </span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 子节点 </span></span><br><span class="line">    children: [], </span><br><span class="line">    <span class="comment">// 唯一标识 </span></span><br><span class="line">    key: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Virtual DOM 中的节点称为 ReactNode，它分为3种类型 ReactElement、ReactFragment 和 ReactText。其中，ReactElement 又分为 ReactComponentElement 和 ReactDOMElement</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">type ReactNode = ReactElement | ReactFragment | ReactText;</span><br><span class="line">type ReactElement = ReactComponentElement | ReactDOMElement;</span><br><span class="line">type ReactDOMElement = &#123; </span><br><span class="line">    type : string,</span><br><span class="line">    props : &#123;</span><br><span class="line">        children : ReactNodeList, </span><br><span class="line">        className : string,</span><br><span class="line">        etc.</span><br><span class="line">    &#125;,</span><br><span class="line">    key : string | boolean | number | <span class="literal">null</span>, </span><br><span class="line">    ref : string | <span class="literal">null</span></span><br><span class="line">&#125;;</span><br><span class="line">type ReactComponentElement&lt;TProps&gt; = &#123; </span><br><span class="line">    type : ReactClass&lt;TProps&gt;,</span><br><span class="line">    props : TProps,</span><br><span class="line">    key : string | boolean | number | <span class="literal">null</span>, </span><br><span class="line">    ref : string | <span class="literal">null</span></span><br><span class="line">&#125;;</span><br><span class="line">type ReactFragment = <span class="built_in">Array</span>&lt;ReactNode | ReactEmpty&gt;; </span><br><span class="line">type ReactNodeList = ReactNode | ReactEmpty;</span><br><span class="line">type ReactText = string | number;</span><br><span class="line">type ReactEmpty = <span class="literal">null</span> | <span class="literal">undefined</span> | boolean;</span><br></pre></td></tr></table></figure>
<h3 id="创建React元素"><a href="#创建React元素" class="headerlink" title="创建React元素"></a>创建React元素</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Nav, Profile;</span><br><span class="line"><span class="comment">// 输入(JSX):</span></span><br><span class="line"><span class="keyword">const</span> app = &lt;Nav color="blue"&gt;&lt;Profile&gt;click&lt;/Profile&gt;&lt;/Nav&gt;;</span><br><span class="line"><span class="comment">// 输出(JavaScript):</span></span><br><span class="line"><span class="keyword">const</span> app = React.createElement(</span><br><span class="line">    Nav,</span><br><span class="line">    &#123;<span class="attr">color</span>:<span class="string">"blue"</span>&#125;, </span><br><span class="line">    React.createElement(Profile, <span class="literal">null</span>, <span class="string">"click"</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>源码路径: /v15.0.0/src/isomorphic/classic/element/ReactElement.js </p>
</blockquote>
<h3 id="初始化组件入口"><a href="#初始化组件入口" class="headerlink" title="初始化组件入口"></a>初始化组件入口</h3><ul>
<li>当 node 为空时，说明 node 不存在，则初始化空组件 ReactEmptyComponent.create(instan- tiateReactComponent)。</li>
<li>当 node 类型为对象时，即是 DOM 标签组件或自定义组件，那么如果 element 类型为字 符 串 时 ， 则 初 始 化 DOM 标 签 组 件 ReactNativeComponent.createInternalComponent (element)，否则初始化自定义组件 ReactCompositeComponentWrapper()。</li>
<li>当 node 类型为字符串或数字时，则初始化文本组件 ReactNativeComponent.create InstanceForText(node)。</li>
<li>如果是其他情况，则不作处理。</li>
</ul>
<blockquote>
<p>源 码 路 径 : /v15.0.0/src/renderers/shared/ reconciler/instantiateReactComponent.js</p>
</blockquote>
<h3 id="DOM-标签组件"><a href="#DOM-标签组件" class="headerlink" title="DOM 标签组件"></a>DOM 标签组件</h3><blockquote>
<p>当开发者 使用 React 时，此时的 <div> 并不是原生 <div> 标签，它其实是 React 生成的 Virtual DOM 对象， 只不过标签名称相同罢了</div></div></p>
</blockquote>
<p>ReactDOMComponent 针对 Virtual DOM 标签的处理主要分为以下两个部分:</p>
<ul>
<li>属性的更新，包括更新样式、更新属性、处理事件等</li>
<li>子节点的更新，包括更新内容、更新子节点，此部分涉及 diff 算法。</li>
</ul>
<ol>
<li>更新属性<br>当执行 mountComponent 方法时，ReactDOMComponent 首先会生成标记和标签，通过 this. createOpenTagMarkupAndPutListeners(transaction) 来处理 DOM 节点的属性和事件。</li>
</ol>
<ul>
<li>如果存在事件，则针对当前的节点添加事件代理，即调用 enqueuePutListener(this, propKey, propValue, transaction)。</li>
<li>如果存在样式，首先会对样式进行合并操作 Object.assign({}, props.style)，然后通过 CSSPropertyOperations.createMarkupForStyles(propValue, this) 创建样式。</li>
<li>通过 DOMPropertyOperations.createMarkupForProperty(propKey, propValue) 创建属性。</li>
<li>通过 DOMPropertyOperations.createMarkupForID(this._domID) 创建唯一标识。</li>
</ul>
<blockquote>
<p>_createOpenTagMarkupAndPutListeners 方法的源码如下(源码路径:/v15.0.0/src/renderers/ dom/shared/ReactDOMComponent.js):</p>
</blockquote>
<h2 id="详解React生命周期"><a href="#详解React生命周期" class="headerlink" title="详解React生命周期"></a>详解React生命周期</h2><h3 id="使用createClass创建自定义组件"><a href="#使用createClass创建自定义组件" class="headerlink" title="使用createClass创建自定义组件"></a>使用createClass创建自定义组件</h3><p>createClass 是创建自定义组件的入口方法，负责管理生命周期中的 getDefaultProps。该方法法在整个生命周期中只执行一次，这样所有实例初始化的 props 将会被共享。通过 createClass 创建自定义组件，利用原型继承 ReactClassComponent 父类，按顺序合并mixin，设置初始化 defaultProps，返回构造函数。当使用 ES6 classes 编写 React 组件时，class MyComponent extends React.Component 其实就 是调用内部方法 createClass 创建组件</p>
<blockquote>
<p>源码路径(src/isomorphic/classic/ class/ReactClass.js#L802)</p>
</blockquote>
<h3 id="阶段一-MOUNTING"><a href="#阶段一-MOUNTING" class="headerlink" title="阶段一:MOUNTING"></a>阶段一:MOUNTING</h3><p>mountComponent 负责管理生命周期中的 getInitialState、componentWillMount、render 和componentDidMount。<br>由于 getDefaultProps 是通过构造函数进行管理的，所以也是整个生命周期中最先开始执行 的。而 mountComponent 只能望洋兴叹，无法调用到 getDefaultProps。这就解释了为何 getDefaultProps只执行一次<br>由于通过 ReactCompositeComponentBase 返回的是一个虚拟节点，所以需要利用 instantiateReactComponent 去得到实例，再使用 mountComponent 拿到结果作为当前自定义元素的结果。</p>
<p>其实，mountComponent 本质上是通过递归渲染内容的，由于递归的特性，父组件的 componentWillMount 在其子组件的 componentWillMount 之前调用，而父组件的 componentDidMount 在其子组件的 componentDidMount 之后调用。</p>
<p>updateComponent 本质上也是通过递归渲染内容的，由于递归的特性，父组件的 componentWillUpdate 是在其子组件的 componentWillUpdate 之前调用的，而父组件的 componentDidUpdate 也是在其子组件的 componentDidUpdate 之后调用的</p>
<p>禁止在 shouldComponentUpdate 和 componentWillUpdate 中调用 setState，这会造成循环 调用，直至耗光浏览器内存后崩溃。</p>
<blockquote>
<p>mountComponent源码: /v15.0.0/src/renderers/shared/reconciler/ReactCompositeComponent.js</p>
</blockquote>
<h2 id="setState-异步更新"><a href="#setState-异步更新" class="headerlink" title="setState 异步更新"></a>setState 异步更新</h2><p> setState 通过一个队列机制实现 state 更新。 当执行 setState 时，会将需要更新的 state 合并 后放入状态队列，而不会立刻更新 this.state，队列机制可以高效地批量更新 state。<br> 当调用 setState 时，实际上会执行 enqueueSetState 方法，并对 partialState 以及_pendingStateQueue 更新队列进行合并操作，最终通过 enqueueUpdate 执行 state 更新。<br> 而 performUpdateIfNecessary 方法会获取 _pendingElement、_pendingStateQueue、_pendingForceUpdate，并调用 receiveComponent 和 updateComponent 方法进行组件更新。<br> 如 果 在 shouldComponentUpdate 或 componentWillUpdate 方 法 中 调 用 setState ， 此 时 this._pendingStateQueue != null，则 performUpdateIfNecessary 方法就会调用 updateComponent 方法进行组件更新，但 updateComponent 方法又会调用 shouldComponentUpdate 和 componentWill- Update 方法，因此造成循环调用，使得浏览器内存占满后崩溃</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            a: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    componentDidMount() &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            a: <span class="keyword">this</span>.state.a + <span class="number">1</span></span><br><span class="line">        &#125;, () =&gt; &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"a1 : "</span>, <span class="keyword">this</span>.state.a)</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                a: <span class="keyword">this</span>.state.a + <span class="number">1</span></span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"a2: "</span>, <span class="keyword">this</span>.state.a)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            a: <span class="keyword">this</span>.state.a + <span class="number">1</span></span><br><span class="line">        &#125;, () =&gt; &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"a3: "</span>, <span class="keyword">this</span>.state.a)</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"a4: "</span>, <span class="keyword">this</span>.state.a)</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"a5: "</span>, <span class="keyword">this</span>.state.a)</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                a: <span class="keyword">this</span>.state.a + <span class="number">1</span></span><br><span class="line">            &#125;, () =&gt; &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"a6 : "</span>, <span class="keyword">this</span>.state.a)</span><br><span class="line">                <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                    a: <span class="keyword">this</span>.state.a + <span class="number">1</span></span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"a7: "</span>, <span class="keyword">this</span>.state.a)</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"a8: "</span>, <span class="keyword">this</span>.state.a);</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                a: <span class="keyword">this</span>.state.a + <span class="number">1</span></span><br><span class="line">            &#125;, () =&gt; &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"a9: "</span>, <span class="keyword">this</span>.state.a);</span><br><span class="line"></span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"a10: "</span>, <span class="keyword">this</span>.state.a);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//上面结果</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * a4: 0</span></span><br><span class="line"><span class="comment"> * a1: 0</span></span><br><span class="line"><span class="comment"> * a2: 1</span></span><br><span class="line"><span class="comment"> * a3: 1</span></span><br><span class="line"><span class="comment"> * a5: 2</span></span><br><span class="line"><span class="comment"> * a6: 3</span></span><br><span class="line"><span class="comment"> * a7: 3</span></span><br><span class="line"><span class="comment"> * a8: 4</span></span><br><span class="line"><span class="comment"> * a9: 5</span></span><br><span class="line"><span class="comment"> * a10: 5</span></span><br><span class="line"><span class="comment"> * /</span></span><br></pre></td></tr></table></figure>
<h2 id="vitrul-diff"><a href="#vitrul-diff" class="headerlink" title="vitrul diff"></a>vitrul diff</h2><blockquote>
<p>源码: /v15.0.0/src/renderers/shared/reconciler/ReactMultiChild.js</p>
</blockquote>
<h2 id="React-Patch-方法"><a href="#React-Patch-方法" class="headerlink" title="React Patch 方法"></a>React Patch 方法</h2><p> 所谓 Patch，简而言之就是将 tree diff 计算出来的 DOM 差异队列更新到真实的 DOM 节点上，最终让浏览器能够渲染出更新的数据。而且，React 并不是计算出一个差异就去执 行一次 Patch，而是计算出全部差异并放入差异队列后，再一次性地去执行 Patch 方法完成真实 DOM 的更新。</p>
<blockquote>
<p>Patch 方 法 的 源 码 如 下 ( 源 码 路 径 : /v15.0.0/src/renderers/dom/client/utils/DOMChildrenOperations.js)</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.hellolc.com/2018/01/06/解读React源码/" data-id="cl6xk2y8n0037c65w43qk5xox" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/深入React技术栈/">深入React技术栈</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="Program Performance-ProgramPerformance" class="article article-type-Program Performance" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/30/ProgramPerformance/" class="article-date">
  <time datetime="2017-12-30T08:06:39.000Z" itemprop="datePublished">2017-12-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/30/ProgramPerformance/">Performance</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Web-Worker"><a href="#Web-Worker" class="headerlink" title="Web Worker"></a>Web Worker</h2><blockquote>
<p>JavaScript是一门单线程语言, 我们可以通过浏览器的<code>Work</code>, 启动多线程来提高性能来处理io密集型计算, 大数据处理等; 但是主进程和子线程是隔离的, 只能通过监听事件和postMessage的方式进行传递消息</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">//在主线程启动线程 注意有跨域问题 而且必须是js可执行脚本</span><br><span class="line">var w1 = new Worker( &quot;http://127.0.0.1:8080/test.js&quot; );</span><br><span class="line">//监听事件, 就可以收到子线程的发送消息</span><br><span class="line">w1.addEventListener(&quot;message&quot;, function(e) &#123;</span><br><span class="line">    console.log(&quot;main process receive: &quot;, e.data)</span><br><span class="line">&#125;)</span><br><span class="line">//对子线程发送信息</span><br><span class="line">w1.postMessage(&quot;hello world&quot;)</span><br><span class="line"></span><br><span class="line">// test.js</span><br><span class="line">console.log(&quot;test.js....&quot;, navigator, location, JSON)</span><br><span class="line">addEventListener( &quot;message&quot;, function(evt)&#123;</span><br><span class="line">    // evt.data</span><br><span class="line">    console.log(&quot;receive: &quot;, evt.data)</span><br><span class="line">    postMessage( &quot;message has received&quot; );</span><br><span class="line">&#125; );</span><br><span class="line">importScripts(&quot;test2.js&quot;)</span><br></pre></td></tr></table></figure>
<h3 id="Work-中可以使用如下全局变量"><a href="#Work-中可以使用如下全局变量" class="headerlink" title="Work 中可以使用如下全局变量"></a>Work 中可以使用如下全局变量</h3><ul>
<li>navigator</li>
<li>location</li>
<li>JSON</li>
<li>importScripts //同步阻塞引入其他脚本</li>
</ul>
<h3 id="Shared-Workers"><a href="#Shared-Workers" class="headerlink" title="Shared Workers"></a>Shared Workers</h3><p>通浏览器同时打开多个tab(同一个页面), 就会同时打开多个work, 此时我们可以用共享work来减少性能资源消耗<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var w1 = new SharedWorker( &quot;http://127.0.0.1:8080/mySharedWorker.js&quot; );</span><br><span class="line"></span><br><span class="line">// 通过port对象作为唯一标识</span><br><span class="line">w1.port.addEventListener( &quot;message&quot;, handleMessages );</span><br><span class="line">w1.port.postMessage( &quot;something cool&quot; );</span><br><span class="line"></span><br><span class="line">//port connect initialized</span><br><span class="line">w1.port.start();</span><br></pre></td></tr></table></figure></p>
<p>在shared worker 内部给来的请求分配一个端口<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// inside the mySharedWorker.js</span><br><span class="line">addEventListener(&quot;connect&quot;, function (event) &#123;</span><br><span class="line">    //分配端口给这个链接</span><br><span class="line">    var port = event.ports[0];</span><br><span class="line"></span><br><span class="line">    port.addEventListener(&quot;message&quot;, function (event) &#123;</span><br><span class="line">        // ....</span><br><span class="line">        port.postMessage( .. );</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    // initialize the port connection</span><br><span class="line">    port.start();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h2 id="SIMD"><a href="#SIMD" class="headerlink" title="SIMD"></a>SIMD</h2><p>SIMD 打算把 CPU 级的并行数学运算映射到 JavaScript API，以获得高性能的数据并行运 算，比如在大数据集上的数字处理。 现在还在研发中, 也许会在es7出现</p>
<h2 id="asm-js"><a href="#asm-js" class="headerlink" title="asm.js"></a>asm.js</h2><p>asm.js 优化了垃圾收集和强制类型转换等部分, 所以适合数学运算(如游戏中的图形处理)</p>
<p><a href="http://asmjs.org/spec/latest/" target="_blank" rel="noopener">asm 代码风格</a><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">    "use asm"</span></span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">45</span>;</span><br><span class="line">    <span class="keyword">var</span> b = a | <span class="number">0</span>; <span class="comment">//因为js是32位的, 但现在的计算机一般都是64位的, 通过`| 0`后, 计算机知道这是32位的变量, 减少了对高位的追踪计算</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> heap = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>( <span class="number">0x10000</span> ); <span class="comment">// 从堆里申请64k内存</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.hellolc.com/2017/12/30/ProgramPerformance/" data-id="cl6xk2y7p0018c65whsugffq7" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/You-Don-t-Know-JS/">You Don't Know JS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Generators" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/02/Generators/" class="article-date">
  <time datetime="2017-12-02T06:17:01.000Z" itemprop="datePublished">2017-12-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/02/Generators/">Generators</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="迭代器"><a href="#迭代器" class="headerlink" title="迭代器"></a>迭代器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function *foo(x) &#123;</span><br><span class="line">	var y = x * (yield function() &#123;return &quot;hello world&quot;;&#125;); </span><br><span class="line">	return y;</span><br><span class="line">&#125;</span><br><span class="line">var it = foo( 6 ); //将6作为参数调用foo方法 并返回一个迭代器对象</span><br><span class="line">// start `foo(..)`</span><br><span class="line">var res1 = it.next(); //开始执行函数, 直到碰到yield 就停住了, 等待下一步指令; 并返回一个迭代器对象值为 &#123;done: false, value: ƒ&#125;, done表示迭代器还没有结束, value表示yield后面的内容; 一般浏览器都会忽略掉第一个next传入的参数</span><br><span class="line">res1.value(); //上面yield后面的内容是一个函数, 所以调用后, 返回&quot;hello world&quot;</span><br><span class="line">var res2 = it.next( 7 ); //将7 作为yield的返回值, 并继续执行至下一个yield或是结束</span><br><span class="line">res2.value; //因此 6 * 7 = 42</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function* test() &#123;</span><br><span class="line">	yield 1;</span><br><span class="line">	yield 2;</span><br><span class="line">	yield 3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var it = test();</span><br><span class="line">for (var v of it) &#123;</span><br><span class="line">	console.log(v)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>for (var v of it)</code> 会自动执行迭代器的next方法, 直到返回的对象<code>done: true</code></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for (var v of it) &#123;&#125;</span><br><span class="line">//可以转化为如下</span><br><span class="line">for (var ret; (ret = it.next()) &amp;&amp; !ret.done; ) &#123;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var arr = [1, 3, 5, 7];</span><br><span class="line">for (var v of arr) &#123;</span><br><span class="line">	console.log(v);//1 3 5 7</span><br><span class="line">&#125;</span><br><span class="line">// 等价于如下</span><br><span class="line">var it = arr[Symbol.iterator]()</span><br><span class="line">it.next();//&#123;value: 1, done: false&#125;</span><br><span class="line">it.next();//&#123;value: 3, done: false&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">function* test() &#123;</span><br><span class="line">	try &#123;</span><br><span class="line">		var nextVal = 1;</span><br><span class="line">		while (true) &#123;</span><br><span class="line">			nextVal += 3;</span><br><span class="line">			yield nextVal;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; finally &#123;</span><br><span class="line">		console.log(&apos;finally...&apos;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var it = test();</span><br><span class="line">for (var v of it) &#123;</span><br><span class="line">	console.log(v)</span><br><span class="line">	if (v &gt; 30 ) &#123;</span><br><span class="line">		var result = it.return(&quot;hello world&quot;)</span><br><span class="line">		console.log(&quot;result: &quot;, result)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line"> * 输出结果: 1 4 .... finally... result: &#123;value: &quot;hello world&quot;, done: true&#125;</span><br><span class="line"> */</span><br></pre></td></tr></table></figure>
<blockquote>
<p>当我们调用迭代器it的return方法时, 迭代器会将it.next的结果done设置为true, 来终端迭代器迭代下去, 然后会执行迭代器里的finally方法(如果有), 最后返回的value的值等于我们return传递进去的值</p>
</blockquote>
<h2 id="自动执行迭代器"><a href="#自动执行迭代器" class="headerlink" title="自动执行迭代器"></a>自动执行迭代器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">function ajax(delay) &#123;</span><br><span class="line">    return new Promise(function(resolve, reject) &#123;</span><br><span class="line">        //延迟返回 模拟异步</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            resolve(&quot;ajax data&quot;);</span><br><span class="line">        &#125;, delay)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function *test(arg) &#123;</span><br><span class="line">    var ajaxRes = yield ajax(arg);</span><br><span class="line">    return yield ajaxRes;</span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line"> * 模拟co库写的一个迭代器递归执行方法</span><br><span class="line"> **/</span><br><span class="line">function co(gen) &#123;</span><br><span class="line">    //获取初始化参数</span><br><span class="line">    var args = [].slice.call(arguments, 1);</span><br><span class="line">    //使用当前作用域初始化gen获取迭代器对象it, 下面it会作为一个闭包对象一直被递归调用</span><br><span class="line">    var it = gen.apply(this, args);</span><br><span class="line">    //返回一个处理好的promise</span><br><span class="line">    return Promise.resolve().then(function handleNext(value) &#123;</span><br><span class="line">        //将上一次promise返回的结果作为参数传递给迭代器, 第一次value为undefined, 一般浏览器会忽略</span><br><span class="line">        var next = it.next(value);</span><br><span class="line">        console.log(&quot;next: &quot;, next);</span><br><span class="line">        </span><br><span class="line">        //函数自运行</span><br><span class="line">        return (function handleResult(next) &#123;</span><br><span class="line">            //判断迭代器是否完成 如果完成返回最后结果</span><br><span class="line">            if (next.done) &#123;</span><br><span class="line">                return next.value;</span><br><span class="line">            &#125; else if (typeof next.value == &apos;function&apos;) &#123;</span><br><span class="line">				//处理thunk类型的回调</span><br><span class="line">				//返回一个promise</span><br><span class="line">				return new Promise(function(resolve, reject) &#123;</span><br><span class="line">					//给thunk传递回调函数</span><br><span class="line">					next.value(function(err, msg) &#123;</span><br><span class="line">						if (err) &#123;</span><br><span class="line">							reject(err);</span><br><span class="line">						&#125; else &#123;</span><br><span class="line">							resolve(msg);</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;)</span><br><span class="line">				&#125;).then(function() &#123;</span><br><span class="line">                    //如果promise返回成功, 就递归调用handleNext来处理it迭代器至完成</span><br><span class="line">                    handleNext,</span><br><span class="line"></span><br><span class="line">                    //异常处理</span><br><span class="line">                    function handleErr(err) &#123;</span><br><span class="line">                        return Promise.resolve(</span><br><span class="line">                            //处理异常</span><br><span class="line">                            it.throw(err)</span><br><span class="line">                        ).then(</span><br><span class="line">                            //继续处理异常处理的结果</span><br><span class="line">                            handleResult</span><br><span class="line">                        )</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">				&#125;)</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">                //否则就递归调用迭代器</span><br><span class="line">                //通过promise处理next.value, 如果next.value是非promise对象就会直接进入then, 否则就等待promise回调then</span><br><span class="line">                //这里的next.value一般都是异步处理, 例如ajax操作</span><br><span class="line">                return Promise.resolve(next.value).then(</span><br><span class="line">                    //如果promise返回成功, 就递归调用handleNext来处理it迭代器至完成</span><br><span class="line">                    handleNext,</span><br><span class="line">					</span><br><span class="line">                    //异常处理</span><br><span class="line">                    function handleErr(err) &#123;</span><br><span class="line">                        return Promise.resolve(</span><br><span class="line">                            //处理异常</span><br><span class="line">                            it.throw(err)</span><br><span class="line">                        ).then(</span><br><span class="line">                            //继续处理异常处理的结果</span><br><span class="line">                            handleResult</span><br><span class="line">                        )</span><br><span class="line">                    &#125;</span><br><span class="line">                );</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)(next)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">co(test, 3000).then(function(res) &#123;</span><br><span class="line">    console.log(&quot;res: &quot;,res)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上面是一个自动递归处理迭代器的方法, 方法类似co库</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">funcion *foo() &#123;</span><br><span class="line">	var r1 = yield ajax(&apos;url1&apos;);</span><br><span class="line">	var r2 = yield ajax(&apos;url2&apos;);</span><br><span class="line"></span><br><span class="line">	var r3 = yield ajax(r1+r2);</span><br><span class="line">	return r3;</span><br><span class="line">&#125;</span><br><span class="line">co(foo);</span><br><span class="line"></span><br><span class="line">//可以优化为下面</span><br><span class="line">funcion *foo() &#123;</span><br><span class="line"></span><br><span class="line">	var p1 = ajax(&apos;url1&apos;);</span><br><span class="line">	var p2 = ajax(&apos;url2&apos;);</span><br><span class="line">	var r1 = yield p1</span><br><span class="line">	var r2 = yield p2</span><br><span class="line"></span><br><span class="line">	var r3 = yield ajax(r1+r2);</span><br><span class="line">	return r3;</span><br><span class="line">&#125;</span><br><span class="line">co(foo);</span><br><span class="line">// 上面那方法可以理解如下</span><br><span class="line">funcion *foo() &#123;</span><br><span class="line">	var results = yield Promise.all([ajax(&apos;url1&apos;), ajax(&apos;url2)]);</span><br><span class="line">	var r1 = results[0];</span><br><span class="line">	var r2 = results[1];</span><br><span class="line"></span><br><span class="line">	var r3 = yield ajax(r1+r2);</span><br><span class="line">	return r3;</span><br><span class="line">&#125;</span><br><span class="line">co(foo);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上面第一个demo, 按照迭代器的方式, 必须等r1的ajax返回结果后, 才会调用r2的ajax, 这样效率就会很低, 所以应该优化为下面那方法, 这样就可以先直接发送2个ajax请求并发, 处理结果使用迭代器</p>
</blockquote>
<h2 id="迭代器的polyfill"><a href="#迭代器的polyfill" class="headerlink" title="迭代器的polyfill"></a>迭代器的polyfill</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">function *foo(url) &#123;</span><br><span class="line">	// STATE *1*</span><br><span class="line">	try &#123;</span><br><span class="line">		console.log( &quot;requesting:&quot;, url );</span><br><span class="line">		var TMP1 = request( url );</span><br><span class="line"></span><br><span class="line">		// STATE *2*</span><br><span class="line">		var val = yield TMP1;</span><br><span class="line">		console.log( val );</span><br><span class="line">	&#125; catch (e) &#123;</span><br><span class="line">		// STATE *3*</span><br><span class="line">		console.log( &quot;Oops:&quot;, err );</span><br><span class="line">		return false;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//polyfill 如下</span><br><span class="line"></span><br><span class="line">function foo(url) &#123;</span><br><span class="line">	// manage generator state</span><br><span class="line">	var state;</span><br><span class="line"></span><br><span class="line">	// generator-wide variable declarations</span><br><span class="line">	var val;</span><br><span class="line">	</span><br><span class="line">	function process(v) &#123;</span><br><span class="line">		switch (state) &#123;</span><br><span class="line">			case 1: </span><br><span class="line">				console.log( &quot;requesting:&quot;, url );</span><br><span class="line">				return request( url );  </span><br><span class="line">			case 2:</span><br><span class="line">				val = v;</span><br><span class="line">				console.log( val );</span><br><span class="line">			case 3:</span><br><span class="line">				var err = v;</span><br><span class="line">				console.log( &quot;Oops:&quot;, err );</span><br><span class="line">				return false;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	return &#123;</span><br><span class="line">		next: function(v) &#123;</span><br><span class="line">			// initial state</span><br><span class="line">			if (!state) &#123; </span><br><span class="line">				state = 1;</span><br><span class="line">				return &#123;</span><br><span class="line">					done: false,</span><br><span class="line">					value: process()</span><br><span class="line">				&#125;;</span><br><span class="line">			// yield resumed successfully</span><br><span class="line">			&#125; else if (state == 1) &#123;</span><br><span class="line">				state = 2;</span><br><span class="line">				return &#123;</span><br><span class="line">					done: true,</span><br><span class="line">					value: process( v )</span><br><span class="line">				&#125;;</span><br><span class="line">			&#125;</span><br><span class="line">			// generator already completed</span><br><span class="line">			else &#123; </span><br><span class="line">				return &#123;</span><br><span class="line">					done: true,</span><br><span class="line">					value: undefined</span><br><span class="line">				&#125;;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		throw: function(e) &#123;</span><br><span class="line">			// the only explicit error handling is in </span><br><span class="line">			// state *1*</span><br><span class="line">			if (state == 1) &#123;</span><br><span class="line">				state = 3; </span><br><span class="line">				return &#123;</span><br><span class="line">					done: true,</span><br><span class="line">					value: process( e )</span><br><span class="line">				&#125;;</span><br><span class="line">			&#125;</span><br><span class="line">			// otherwise, an error won&apos;t be handled, </span><br><span class="line">			// so just throw it right back out</span><br><span class="line">			else &#123;</span><br><span class="line">				throw e; </span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.hellolc.com/2017/12/02/Generators/" data-id="cl6xk2y76000ec65wzslrfh3y" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/You-Don-t-Know-JS/">You Don't Know JS</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/3/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Core-HTML5-Canvas/">Core HTML5 Canvas</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JAVA/">JAVA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript-Web-Applications/">JavaScript Web Applications</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript设计模式与开发实践/">JavaScript设计模式与开发实践</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jquery/">Jquery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pro-Git/">Pro Git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ReactNative/">ReactNative</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vim实用技巧/">Vim实用技巧</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/You-Don-t-Know-JS/">You Don't Know JS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html5/">html5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javaScript高级程序设计笔记/">javaScript高级程序设计笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux系统编程/">linux系统编程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tools/">tools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构与算法/">数据结构与算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/深入React技术栈/">深入React技术栈</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/深入浅出Node-js/">深入浅出Node.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/深入理解计算机系统/">深入理解计算机系统</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/设计模式/">设计模式</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Core-HTML5-Canvas/" style="font-size: 12px;">Core HTML5 Canvas</a> <a href="/tags/JAVA/" style="font-size: 10px;">JAVA</a> <a href="/tags/JavaScript/" style="font-size: 18px;">JavaScript</a> <a href="/tags/JavaScript-Web-Applications/" style="font-size: 12px;">JavaScript Web Applications</a> <a href="/tags/JavaScript设计模式与开发实践/" style="font-size: 10px;">JavaScript设计模式与开发实践</a> <a href="/tags/Jquery/" style="font-size: 10px;">Jquery</a> <a href="/tags/Pro-Git/" style="font-size: 10px;">Pro Git</a> <a href="/tags/ReactNative/" style="font-size: 12px;">ReactNative</a> <a href="/tags/Vim实用技巧/" style="font-size: 10px;">Vim实用技巧</a> <a href="/tags/You-Don-t-Know-JS/" style="font-size: 16px;">You Don't Know JS</a> <a href="/tags/css/" style="font-size: 12px;">css</a> <a href="/tags/html5/" style="font-size: 10px;">html5</a> <a href="/tags/javaScript高级程序设计笔记/" style="font-size: 20px;">javaScript高级程序设计笔记</a> <a href="/tags/linux系统编程/" style="font-size: 10px;">linux系统编程</a> <a href="/tags/tools/" style="font-size: 10px;">tools</a> <a href="/tags/数据结构与算法/" style="font-size: 10px;">数据结构与算法</a> <a href="/tags/深入React技术栈/" style="font-size: 14px;">深入React技术栈</a> <a href="/tags/深入浅出Node-js/" style="font-size: 10px;">深入浅出Node.js</a> <a href="/tags/深入理解计算机系统/" style="font-size: 10px;">深入理解计算机系统</a> <a href="/tags/算法/" style="font-size: 12px;">算法</a> <a href="/tags/设计模式/" style="font-size: 10px;">设计模式</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/10/20/FastJSON Key Hash冲突问题/">FastJSON Key Hash冲突问题</a>
          </li>
        
          <li>
            <a href="/2018/05/18/设计模式/">设计模式</a>
          </li>
        
          <li>
            <a href="/2018/05/09/数据结构/">数据结构与算法</a>
          </li>
        
          <li>
            <a href="/2018/05/06/Drawing/">Drawing</a>
          </li>
        
          <li>
            <a href="/2018/05/02/Vim实用技巧/">Vim实用技巧</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 lichen<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>