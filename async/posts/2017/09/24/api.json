{"tags":[{"name":"javaScript高级程序设计笔记","permalink":"http://blog.hellolc.com,http://www.wjcun.com/tags/javaScript高级程序设计笔记/","url":"/async/tags/javaScript高级程序设计笔记.json","count":17}],"categories":[],"url":"/async/posts/2017/09/24/api.json","date":1506257531000,"path":{"year":2017,"month":9,"day":24,"name":"api"},"title":"api","permalink":"http://blog.hellolc.com,http://www.wjcun.com/2017/09/24/api/","content":"<h2 id=\"Page-Visibility\"><a href=\"#Page-Visibility\" class=\"headerlink\" title=\"Page Visibility\"></a>Page Visibility</h2><ul>\n<li>document.hidden 表示页面是否隐藏</li>\n<li>document.visibilityState: 有4个状态的值</li>\n<li>visibiliteChagne事件</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">document.addEventListener(&apos;visibiliteChagne&apos;, function(event) &#123;</span><br><span class=\"line\">\tif (document.hidden) &#123;</span><br><span class=\"line\">\t\t//do something</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<h2 id=\"Geolocation-API\"><a href=\"#Geolocation-API\" class=\"headerlink\" title=\"Geolocation API\"></a>Geolocation API</h2><blockquote>\n<p>获取用户地理位置</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">navigator.geolocation.getCurrentPosition(function(position) &#123;</span><br><span class=\"line\">\tconsole.log(position.coords.latitude, position.coords.longitude);</span><br><span class=\"line\">&#125;, function(error) &#123;</span><br><span class=\"line\">\tconsole.log(error)</span><br><span class=\"line\">&#125;, &#123;</span><br><span class=\"line\">\tenableHighAccuracy: true, //尽可能使用精确的位置信息</span><br><span class=\"line\">\ttimeout: 5000,//等待位置信息的最长时间</span><br><span class=\"line\">\tmaximumAge: 25000//上一次获取的坐标信息的有效时间</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<ul>\n<li>watchPosition方法和getCurrentPosition类似, 但是它会定时调用getCurrentPosition的效果相同</li>\n<li>clearWatch 取消监听</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var watchId = navigator.geolocation.watchPosition方法和getCurrentPosition类似(function(position) &#123;</span><br><span class=\"line\">\tconsole.log(position.coords.latitude, position.coords.longitude);</span><br><span class=\"line\">&#125;, function(error) &#123;</span><br><span class=\"line\">\tconsole.log(error)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">//取消监听</span><br><span class=\"line\">clearWatch(watchId);</span><br></pre></td></tr></table></figure>\n<h2 id=\"FileReader-类型\"><a href=\"#FileReader-类型\" class=\"headerlink\" title=\"FileReader 类型\"></a>FileReader 类型</h2><blockquote>\n<p>可以异步读取上传文件中的数据</p>\n</blockquote>\n<ul>\n<li>readAsText(file, encoding) 以纯文本形式读取文件</li>\n<li>readAsDataURL(file) 读取文件以URI的形式保存</li>\n<li>readAsBinaryString(file) 获取字符串, 每个字符表示一个字节</li>\n<li>readAsArrayBuffer(file) 获取ArrayBuffer类型的内容</li>\n</ul>\n<p><img src=\"https://img.alicdn.com/tfs/TB1b_bwggoQMeJjy0FoXXcShVXa-1224-1480.png\" alt=\"应用\"></p>\n<h2 id=\"对象URL\"><a href=\"#对象URL\" class=\"headerlink\" title=\"对象URL\"></a>对象URL</h2><blockquote>\n<p>可以不必将数据内容读取到JavaScript中而直接使用, 可以使用<code>window.URL.createObjectURL()</code>方法, 返回字符串, 指向内存地址</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var url = window.URL.createObjectURL(files[0])</span><br><span class=\"line\">var output.innerHTML = &apos;&lt;img src=&quot;&apos; + url + &apos;&quot;&gt;&apos;;</span><br><span class=\"line\"></span><br><span class=\"line\">//释放内存</span><br><span class=\"line\">window.URL.revokeObjectURL(url);</span><br></pre></td></tr></table></figure>\n<h2 id=\"读取拖放的文件\"><a href=\"#读取拖放的文件\" class=\"headerlink\" title=\"读取拖放的文件\"></a>读取拖放的文件</h2><blockquote>\n<p>html5可以直接拖入文件, 可以通过<code>files = event.dataTransfer.files;</code>获取拖入文件并获取文件信息</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var droptarget = document.getElementById(&quot;droptarget&quot;);</span><br><span class=\"line\">function handleEvent(event) &#123;</span><br><span class=\"line\">\tvar info = &quot;&quot;,</span><br><span class=\"line\">\t\toutput = document.getElemntById(&quot;output&quot;),</span><br><span class=\"line\">\t\tfiles, i, len;</span><br><span class=\"line\"></span><br><span class=\"line\">\tEvenUtil.preventDefault(event);</span><br><span class=\"line\">\tif (event.type == drop) &#123;</span><br><span class=\"line\">\t\tfiles = event.dataTransfer.files;</span><br><span class=\"line\">\t\ti = 0;</span><br><span class=\"line\">\t\tlen = files.length;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\twhile (i &lt; len) &#123;</span><br><span class=\"line\">\t\t\t//获取文件信息</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">EvenUtil.addHandle(droptarget, &quot;dropenter&quot;, handleEvent);</span><br><span class=\"line\">EvenUtil.addHandle(droptarget, &quot;dropover&quot;, handleEvent);</span><br><span class=\"line\">EvenUtil.addHandle(droptarget, &quot;drop&quot;, handleEvent);</span><br></pre></td></tr></table></figure>\n"}