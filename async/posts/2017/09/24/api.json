{"tags":[{"name":"javaScript高级程序设计笔记","permalink":"http://blog.hellolc.com/tags/javaScript高级程序设计笔记/","url":"/async/tags/javaScript高级程序设计笔记.json","count":17}],"categories":[],"url":"/async/posts/2017/09/24/api.json","date":1506257531000,"path":{"year":2017,"month":9,"day":24,"name":"api"},"title":"api","permalink":"http://blog.hellolc.com/2017/09/24/api/","content":"<h2 id=\"Page-Visibility\"><a href=\"#Page-Visibility\" class=\"headerlink\" title=\"Page Visibility\"></a>Page Visibility</h2><ul>\n<li>document.hidden 表示页面是否隐藏</li>\n<li>document.visibilityState: 有4个状态的值</li>\n<li>visibiliteChagne事件</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">document.addEventListener(&apos;visibiliteChagne&apos;, function(event) &#123;</div><div class=\"line\">\tif (document.hidden) &#123;</div><div class=\"line\">\t\t//do something</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;)</div></pre></td></tr></table></figure>\n<h2 id=\"Geolocation-API\"><a href=\"#Geolocation-API\" class=\"headerlink\" title=\"Geolocation API\"></a>Geolocation API</h2><blockquote>\n<p>获取用户地理位置</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">navigator.geolocation.getCurrentPosition(function(position) &#123;</div><div class=\"line\">\tconsole.log(position.coords.latitude, position.coords.longitude);</div><div class=\"line\">&#125;, function(error) &#123;</div><div class=\"line\">\tconsole.log(error)</div><div class=\"line\">&#125;, &#123;</div><div class=\"line\">\tenableHighAccuracy: true, //尽可能使用精确的位置信息</div><div class=\"line\">\ttimeout: 5000,//等待位置信息的最长时间</div><div class=\"line\">\tmaximumAge: 25000//上一次获取的坐标信息的有效时间</div><div class=\"line\">&#125;)</div></pre></td></tr></table></figure>\n<ul>\n<li>watchPosition方法和getCurrentPosition类似, 但是它会定时调用getCurrentPosition的效果相同</li>\n<li>clearWatch 取消监听</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">var watchId = navigator.geolocation.watchPosition方法和getCurrentPosition类似(function(position) &#123;</div><div class=\"line\">\tconsole.log(position.coords.latitude, position.coords.longitude);</div><div class=\"line\">&#125;, function(error) &#123;</div><div class=\"line\">\tconsole.log(error)</div><div class=\"line\">&#125;)</div><div class=\"line\"></div><div class=\"line\">//取消监听</div><div class=\"line\">clearWatch(watchId);</div></pre></td></tr></table></figure>\n<h2 id=\"FileReader-类型\"><a href=\"#FileReader-类型\" class=\"headerlink\" title=\"FileReader 类型\"></a>FileReader 类型</h2><blockquote>\n<p>可以异步读取上传文件中的数据</p>\n</blockquote>\n<ul>\n<li>readAsText(file, encoding) 以纯文本形式读取文件</li>\n<li>readAsDataURL(file) 读取文件以URI的形式保存</li>\n<li>readAsBinaryString(file) 获取字符串, 每个字符表示一个字节</li>\n<li>readAsArrayBuffer(file) 获取ArrayBuffer类型的内容</li>\n</ul>\n<p><img src=\"https://img.alicdn.com/tfs/TB1b_bwggoQMeJjy0FoXXcShVXa-1224-1480.png\" alt=\"应用\"></p>\n<h2 id=\"对象URL\"><a href=\"#对象URL\" class=\"headerlink\" title=\"对象URL\"></a>对象URL</h2><blockquote>\n<p>可以不必将数据内容读取到JavaScript中而直接使用, 可以使用<code>window.URL.createObjectURL()</code>方法, 返回字符串, 指向内存地址</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">var url = window.URL.createObjectURL(files[0])</div><div class=\"line\">var output.innerHTML = &apos;&lt;img src=&quot;&apos; + url + &apos;&quot;&gt;&apos;;</div><div class=\"line\"></div><div class=\"line\">//释放内存</div><div class=\"line\">window.URL.revokeObjectURL(url);</div></pre></td></tr></table></figure>\n<h2 id=\"读取拖放的文件\"><a href=\"#读取拖放的文件\" class=\"headerlink\" title=\"读取拖放的文件\"></a>读取拖放的文件</h2><blockquote>\n<p>html5可以直接拖入文件, 可以通过<code>files = event.dataTransfer.files;</code>获取拖入文件并获取文件信息</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\">var droptarget = document.getElementById(&quot;droptarget&quot;);</div><div class=\"line\">function handleEvent(event) &#123;</div><div class=\"line\">\tvar info = &quot;&quot;,</div><div class=\"line\">\t\toutput = document.getElemntById(&quot;output&quot;),</div><div class=\"line\">\t\tfiles, i, len;</div><div class=\"line\"></div><div class=\"line\">\tEvenUtil.preventDefault(event);</div><div class=\"line\">\tif (event.type == drop) &#123;</div><div class=\"line\">\t\tfiles = event.dataTransfer.files;</div><div class=\"line\">\t\ti = 0;</div><div class=\"line\">\t\tlen = files.length;</div><div class=\"line\"></div><div class=\"line\">\t\twhile (i &lt; len) &#123;</div><div class=\"line\">\t\t\t//获取文件信息</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\">EvenUtil.addHandle(droptarget, &quot;dropenter&quot;, handleEvent);</div><div class=\"line\">EvenUtil.addHandle(droptarget, &quot;dropover&quot;, handleEvent);</div><div class=\"line\">EvenUtil.addHandle(droptarget, &quot;drop&quot;, handleEvent);</div></pre></td></tr></table></figure>\n"}