{"tags":[{"name":"javaScript高级程序设计笔记","permalink":"http://blog.hellolc.com/tags/javaScript高级程序设计笔记/","url":"/async/tags/javaScript高级程序设计笔记.json","count":11}],"categories":[],"url":"/async/posts/2017/08/31/HTML5脚本编程.json","date":1504144619000,"path":{"year":2017,"month":8,"day":31,"name":"HTML5脚本编程"},"title":"HTML5脚本编程","permalink":"http://blog.hellolc.com/2017/08/31/HTML5脚本编程/","content":"<h2 id=\"跨文档消息传递\"><a href=\"#跨文档消息传递\" class=\"headerlink\" title=\"跨文档消息传递\"></a>跨文档消息传递</h2><blockquote>\n<p>postMessage传递的消息, 最早只支持字符串, 后来有些浏览器支持了任何数据结构, 但为了保证安全建议<code>JSON.stringify</code>转换为字符串再传递</p>\n</blockquote>\n<ul>\n<li>postMessage(一条消息, 消息接受方来自哪个域的字符串) 发送消息</li>\n<li>onmessage(data, origin, source) 接受消息</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">var iframe = document.getElementById(&quot;#ifrmae&quot;);</div><div class=\"line\">iframe.postMessage(&quot;some data&quot;, &quot;http://test.com&quot;);</div><div class=\"line\"></div><div class=\"line\">window.onmessage = function(data, origin, source) &#123;</div><div class=\"line\">\tconsole.log(data, origin, source)</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"原生拖放\"><a href=\"#原生拖放\" class=\"headerlink\" title=\"原生拖放\"></a>原生拖放</h2><h3 id=\"拖放事件\"><a href=\"#拖放事件\" class=\"headerlink\" title=\"拖放事件\"></a>拖放事件</h3><ul>\n<li>dragstart</li>\n<li>drag</li>\n<li>dragend</li>\n</ul>\n<blockquote>\n<p>当元素拖动到另一个有效的放置目标上时, 会触发以下事件</p>\n</blockquote>\n<ul>\n<li>dragenter</li>\n<li>dragover</li>\n<li>dragleave 或 drop</li>\n</ul>\n<h3 id=\"自定义放置目标\"><a href=\"#自定义放置目标\" class=\"headerlink\" title=\"自定义放置目标\"></a>自定义放置目标</h3><blockquote>\n<p>元素默认是不允许放置的, 可用阻止默认事件来允许放置</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">droptarget.ondragover = function(event) &#123;</div><div class=\"line\">\tevent.preventDefault();</div><div class=\"line\">&#125;</div><div class=\"line\">droptarget.ondragenter = function(event) &#123;</div><div class=\"line\">\tevent.preventDefault();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"dataTransfer-对象\"><a href=\"#dataTransfer-对象\" class=\"headerlink\" title=\"dataTransfer 对象\"></a>dataTransfer 对象</h3><blockquote>\n<p>在触发拖放事件时, 可以通过这个对象读取或者设置数据</p>\n</blockquote>\n<ul>\n<li>dataTransfer.setData(text/URL, ‘str’);</li>\n<li>dataTransfer.getData(text/URL)</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\">event.dataTransfer.setData(&quot;text&quot;, &quot;some text&quot;);</div><div class=\"line\">var text = event.dataTransfer.getData(&quot;text&quot;);</div><div class=\"line\"></div><div class=\"line\">event.dataTransfer.setData(&quot;URL&quot;, &quot;http://test.com&quot;);</div><div class=\"line\">var url = event.dataTransfer.getData(&quot;URL&quot;);</div><div class=\"line\"></div><div class=\"line\">// 为了浏览器兼容 已写成如下</div><div class=\"line\">var dataTransfer = event.dataTransfer;</div><div class=\"line\">var url = dataTransfer.getData(&quot;url&quot;) || dataTransfer.getData(&quot;text/uri-list&quot;);</div><div class=\"line\">var text = dataTransfer.getData(&quot;Text&quot;);</div></pre></td></tr></table></figure>\n<h3 id=\"dropEffect-与-effectAllowed\"><a href=\"#dropEffect-与-effectAllowed\" class=\"headerlink\" title=\"dropEffect 与 effectAllowed\"></a>dropEffect 与 effectAllowed</h3><p><img src=\"https://img.alicdn.com/tfs/TB1Zg9sa_ZRMeJjSspkXXXGpXXa-1992-1412.png\" alt=\"dropEffect 与 effectAllowed\"></p>\n<h3 id=\"可拖动\"><a href=\"#可拖动\" class=\"headerlink\" title=\"可拖动\"></a>可拖动</h3><blockquote>\n<p>设置<code>draggable=&quot;true&quot;</code></p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;div style=&quot;width: 100px;height: 100px;background-color:red;&quot; draggable=&quot;true&quot;&gt;&lt;/div&gt;</div></pre></td></tr></table></figure>\n<h3 id=\"其他成员\"><a href=\"#其他成员\" class=\"headerlink\" title=\"其他成员\"></a>其他成员</h3><p><img src=\"https://img.alicdn.com/tfs/TB1YLiBa3MPMeJjy1XbXXcwxVXa-1938-1418.png\" alt=\"其他成员方法\"></p>\n<h2 id=\"媒体元素\"><a href=\"#媒体元素\" class=\"headerlink\" title=\"媒体元素\"></a>媒体元素</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">//视频</div><div class=\"line\">&lt;video src=&quot;video.mpg&quot;&gt;&lt;/video&gt;</div><div class=\"line\">//音频</div><div class=\"line\">&lt;audio src=&quot;song.mp3&quot;&gt;&lt;/audio&gt;</div></pre></td></tr></table></figure>\n<blockquote>\n<p>不是所有浏览器都支持所有格式 可以使用<code>&lt;source&gt;</code></p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;video&gt;</div><div class=\"line\">\t&lt;source src=&quot;video.webm&quot; type=&quot;video/webm&quot;&gt;</div><div class=\"line\">\t&lt;source src=&quot;video.ogv&quot; type=&quot;video/ogg&quot;&gt;</div><div class=\"line\">&lt;/video&gt;</div></pre></td></tr></table></figure>\n<h3 id=\"属性\"><a href=\"#属性\" class=\"headerlink\" title=\"属性\"></a>属性</h3><p><img src=\"https://img.alicdn.com/tfs/TB1nzyya.gQMeJjy0FiXXXhqXXa-1408-1478.png\" alt=\"属性\"></p>\n<h3 id=\"事件\"><a href=\"#事件\" class=\"headerlink\" title=\"事件\"></a>事件</h3><p><img src=\"https://img.alicdn.com/tfs/TB1WR9Da3MPMeJjy1XbXXcwxVXa-1448-1310.png\" alt=\"事件\"></p>\n<h2 id=\"历史状态管理\"><a href=\"#历史状态管理\" class=\"headerlink\" title=\"历史状态管理\"></a>历史状态管理</h2><blockquote>\n<p>现在很多页面都是利用hashchange事件, 改变页面, 所以我们可以通过监听此事件, 向history添加历史, 这样历史的前进和后退又可以用了</p>\n</blockquote>\n<ul>\n<li>history.pushState(状体对象, 新状态的标题, 可选的相对url) 添加历史</li>\n<li>history.popstate() 后退</li>\n<li>history.replaceState(状体对象, 新状态的标题) 更新替换</li>\n</ul>\n"}