{"tags":[{"name":"深入理解计算机系统","permalink":"http://blog.hellolc.com/tags/深入理解计算机系统/","url":"/async/tags/深入理解计算机系统.json","count":1}],"categories":[],"url":"/async/posts/2018/02/25/深入理解计算机系统.json","date":1519553234000,"path":{"year":2018,"month":2,"day":25,"name":"深入理解计算机系统"},"title":"深入理解计算机系统","permalink":"http://blog.hellolc.com/2018/02/25/深入理解计算机系统/","content":"<h3 id=\"为什么32位系统只能支持4G内存\"><a href=\"#为什么32位系统只能支持4G内存\" class=\"headerlink\" title=\"为什么32位系统只能支持4G内存?\"></a>为什么32位系统只能支持4G内存?</h3><blockquote>\n<p>因为每台计算机都有一个字长, 这也是指针的大小, 32位系统的指针字长为4字节, 也就是32位, 因此它能表示的地址为 <code>0 ~ 2^32 - 1</code>, 所以超出4G的内存地址, 它是无法表示的</p>\n</blockquote>\n<h3 id=\"int-long-int32-t-int64-t类型的区别\"><a href=\"#int-long-int32-t-int64-t类型的区别\" class=\"headerlink\" title=\"int, long, int32_t, int64_t类型的区别?\"></a>int, long, int32_t, int64_t类型的区别?</h3><blockquote>\n<p>long 类型在32位系统是4字节, 在64位是8字节, 为了不同的编译系统导致不同的分配字节, 因此引入了int32_t, int64_t类型</p>\n</blockquote>\n<h3 id=\"逻辑位移和算数位移\"><a href=\"#逻辑位移和算数位移\" class=\"headerlink\" title=\"逻辑位移和算数位移\"></a>逻辑位移和算数位移</h3><blockquote>\n<p>逻辑位移向右位移时, 高位以0补充, 算数位移向右位移高位以最高有效值补充, 一般无符号以逻辑位移方式, 有符号位移按算数位移方式</p>\n</blockquote>\n<h3 id=\"无符号与有符号进行运算\"><a href=\"#无符号与有符号进行运算\" class=\"headerlink\" title=\"无符号与有符号进行运算\"></a>无符号与有符号进行运算</h3><blockquote>\n<p>无符号与有符号数进行运算, 有符号数被会转成无符号数进行运算<br><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">const</span> <span class=\"keyword\">char</span> * argv[])</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> a = <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> b = <span class=\"number\">-2</span>;</span><br><span class=\"line\">    <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"result: \"</span> &lt;&lt; a + b &lt;&lt; <span class=\"string\">\" 2^32: \"</span> &lt;&lt; <span class=\"built_in\">pow</span>(<span class=\"number\">2</span>, <span class=\"number\">32</span>) &lt;&lt; <span class=\"string\">\" a+b-2^32: \"</span> &lt;&lt; a + b - <span class=\"built_in\">pow</span>(<span class=\"number\">2</span>, <span class=\"number\">32</span>) &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">    <span class=\"comment\">//result: 4294967295 2^32: 4.29497e+09 a+b-2^32: -1</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n</blockquote>\n<h3 id=\"unsigned-导致的BUG\"><a href=\"#unsigned-导致的BUG\" class=\"headerlink\" title=\"unsigned 导致的BUG\"></a>unsigned 导致的BUG</h3><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">float</span> <span class=\"title\">sum_elements</span><span class=\"params\">(<span class=\"keyword\">float</span> a[], <span class=\"keyword\">unsigned</span> length)</span>  </span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;  </span><br><span class=\"line\">    <span class=\"keyword\">int</span> i = <span class=\"number\">0</span>;  </span><br><span class=\"line\">    <span class=\"keyword\">float</span> sum = <span class=\"number\">0</span>;  </span><br><span class=\"line\">    <span class=\"comment\">//length为无符号 length-1的结果也是无符号,  所以不管结果是正数还是负数, 对于程序猿而言都是大于0的</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(i = <span class=\"number\">0</span>; i &lt;= length <span class=\"number\">-1</span>; ++i)  </span><br><span class=\"line\">        sum += a[i];  </span><br><span class=\"line\">    <span class=\"keyword\">return</span> sum;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//size_t ==&gt; unsigned int</span></span><br><span class=\"line\"><span class=\"keyword\">size_t</span> <span class=\"built_in\">strlen</span>(<span class=\"keyword\">const</span> <span class=\"keyword\">char</span> *s); </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">strlonger</span><span class=\"params\">(<span class=\"keyword\">char</span> *s1, <span class=\"keyword\">char</span> *s2)</span>  </span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;  </span><br><span class=\"line\">    <span class=\"comment\">//因为strlen返回的结果是unsigned int  所以下面的结果都是大于0的 应改为strlen(s1) &gt; strlen(s2)</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">strlen</span>(s1) - <span class=\"built_in\">strlen</span>(s2) &gt; <span class=\"number\">0</span>;  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"汇编\"><a href=\"#汇编\" class=\"headerlink\" title=\"汇编\"></a>汇编</h2><h3 id=\"寄存器\"><a href=\"#寄存器\" class=\"headerlink\" title=\"寄存器\"></a>寄存器</h3><table>\n<thead>\n<tr>\n<th>63</th>\n<th style=\"text-align:center\">31</th>\n<th style=\"text-align:center\">15</th>\n<th style=\"text-align:center\">7</th>\n<th style=\"text-align:right\">0 </th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>%rax</td>\n<td style=\"text-align:center\">%eax</td>\n<td style=\"text-align:center\">%ax</td>\n<td style=\"text-align:center\">%al</td>\n<td style=\"text-align:right\">返回值 </td>\n</tr>\n<tr>\n<td>%rbx</td>\n<td style=\"text-align:center\">%ebx</td>\n<td style=\"text-align:center\">%bx</td>\n<td style=\"text-align:center\">%bl</td>\n<td style=\"text-align:right\">被调用者保存 </td>\n</tr>\n<tr>\n<td>%rcx</td>\n<td style=\"text-align:center\">%ecx</td>\n<td style=\"text-align:center\">%cx</td>\n<td style=\"text-align:center\">%cl</td>\n<td style=\"text-align:right\">第4个参数 </td>\n</tr>\n<tr>\n<td>%rdx</td>\n<td style=\"text-align:center\">%edx</td>\n<td style=\"text-align:center\">%dx</td>\n<td style=\"text-align:center\">%dl</td>\n<td style=\"text-align:right\">第3个参数 </td>\n</tr>\n<tr>\n<td>%rsi</td>\n<td style=\"text-align:center\">%esi</td>\n<td style=\"text-align:center\">%si</td>\n<td style=\"text-align:center\">%sil</td>\n<td style=\"text-align:right\">第2个参数 </td>\n</tr>\n<tr>\n<td>%rdi</td>\n<td style=\"text-align:center\">%edi</td>\n<td style=\"text-align:center\">%di</td>\n<td style=\"text-align:center\">%dil</td>\n<td style=\"text-align:right\">第1个参数 </td>\n</tr>\n<tr>\n<td>%rbp</td>\n<td style=\"text-align:center\">%ebp</td>\n<td style=\"text-align:center\">%bp</td>\n<td style=\"text-align:center\">%bpl</td>\n<td style=\"text-align:right\">被调用者保存 </td>\n</tr>\n<tr>\n<td>%rsp</td>\n<td style=\"text-align:center\">%esp</td>\n<td style=\"text-align:center\">%sp</td>\n<td style=\"text-align:center\">%spl</td>\n<td style=\"text-align:right\">栈指针 </td>\n</tr>\n<tr>\n<td>%r8</td>\n<td style=\"text-align:center\">%r8d</td>\n<td style=\"text-align:center\">%r8w</td>\n<td style=\"text-align:center\">%r8b</td>\n<td style=\"text-align:right\">第5个参数 </td>\n</tr>\n<tr>\n<td>%r9</td>\n<td style=\"text-align:center\">%r9d</td>\n<td style=\"text-align:center\">%r9w</td>\n<td style=\"text-align:center\">%r9b</td>\n<td style=\"text-align:right\">第6个参数 </td>\n</tr>\n<tr>\n<td>%r10</td>\n<td style=\"text-align:center\">%r10d</td>\n<td style=\"text-align:center\">%r10w</td>\n<td style=\"text-align:center\">%r10b</td>\n<td style=\"text-align:right\">调用者保存</td>\n</tr>\n<tr>\n<td>%r11</td>\n<td style=\"text-align:center\">%r11d</td>\n<td style=\"text-align:center\">%r11w</td>\n<td style=\"text-align:center\">%r11b</td>\n<td style=\"text-align:right\">调用者保存</td>\n</tr>\n<tr>\n<td>%r12</td>\n<td style=\"text-align:center\">%r12d</td>\n<td style=\"text-align:center\">%r12w</td>\n<td style=\"text-align:center\">%r12b</td>\n<td style=\"text-align:right\">被调用者保存</td>\n</tr>\n<tr>\n<td>%r13</td>\n<td style=\"text-align:center\">%r13d</td>\n<td style=\"text-align:center\">%r13w</td>\n<td style=\"text-align:center\">%r13b</td>\n<td style=\"text-align:right\">被调用者保存</td>\n</tr>\n<tr>\n<td>%r14</td>\n<td style=\"text-align:center\">%r14d</td>\n<td style=\"text-align:center\">%r14w</td>\n<td style=\"text-align:center\">%r14b</td>\n<td style=\"text-align:right\">被调用者保存</td>\n</tr>\n<tr>\n<td>%r15</td>\n<td style=\"text-align:center\">%r15d</td>\n<td style=\"text-align:center\">%r15w</td>\n<td style=\"text-align:center\">%r15b</td>\n<td style=\"text-align:right\">被调用者保存</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>movb(传送字节)</li>\n<li>movw(传送字)</li>\n<li>movl(传送双字 long  word)</li>\n<li>movq(传送四字)</li>\n<li>movs(传送单精读)</li>\n<li>movl(传送双精度) 与传送双字一样 但是浮点运送用的是完全不同的指令和寄存器 因此不会有冲突</li>\n</ul>\n<h3 id=\"操作数指示符\"><a href=\"#操作数指示符\" class=\"headerlink\" title=\"操作数指示符\"></a>操作数指示符</h3><table>\n<thead>\n<tr>\n<th>类型</th>\n<th style=\"text-align:center\">格式</th>\n<th style=\"text-align:right\">操作数 </th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>立即数</td>\n<td style=\"text-align:center\">$Imm</td>\n<td style=\"text-align:right\">Imm</td>\n</tr>\n<tr>\n<td>寄存器</td>\n<td style=\"text-align:center\">ra</td>\n<td style=\"text-align:right\">R[ra]</td>\n</tr>\n<tr>\n<td>内存</td>\n<td style=\"text-align:center\">Imm</td>\n<td style=\"text-align:right\">M[Imm]</td>\n</tr>\n<tr>\n<td>内存</td>\n<td style=\"text-align:center\">(ra)</td>\n<td style=\"text-align:right\">M[R[ra]]</td>\n</tr>\n<tr>\n<td>内存</td>\n<td style=\"text-align:center\">Imm(ra)</td>\n<td style=\"text-align:right\">M[Imm + R[ra]]</td>\n</tr>\n<tr>\n<td>内存</td>\n<td style=\"text-align:center\">(rb, ri)</td>\n<td style=\"text-align:right\">M[R[rb] + R[ri]]</td>\n</tr>\n<tr>\n<td>内存</td>\n<td style=\"text-align:center\">Imm(rb, ri)</td>\n<td style=\"text-align:right\">M[Imm + R[rb] + R[ri]]</td>\n</tr>\n<tr>\n<td>内存</td>\n<td style=\"text-align:center\">(, ri, s)</td>\n<td style=\"text-align:right\">M[R[ri] * s]</td>\n</tr>\n<tr>\n<td>内存</td>\n<td style=\"text-align:center\">Imm(, ri, s)</td>\n<td style=\"text-align:right\">M[Imm + R[ri] * s]</td>\n</tr>\n<tr>\n<td>内存</td>\n<td style=\"text-align:center\">(rb, ri, s)</td>\n<td style=\"text-align:right\">M[R[rb] + R[ri] * s]</td>\n</tr>\n<tr>\n<td>内存</td>\n<td style=\"text-align:center\">Imm(rb, ri, s)</td>\n<td style=\"text-align:right\">M[Imm + R[rb] + R[ri] * s]</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"MOV-S-D\"><a href=\"#MOV-S-D\" class=\"headerlink\" title=\"MOV S, D\"></a>MOV S, D</h3><ul>\n<li>MOVZ 目的中剩余的z字节填充0</li>\n<li>MOVS 目的中剩余的z字节填充符号位</li>\n</ul>\n<blockquote>\n<p>间接引用指针实际上就是从寄存器中取出指针所保存的地址, 然后从内存找到相应的地址<code>(%rdi)</code>; 局部变量通常是放在寄存器中;</p>\n</blockquote>\n<pre><code class=\"c\"><span class=\"function\"><span class=\"keyword\">long</span> <span class=\"title\">exchange</span><span class=\"params\">(<span class=\"keyword\">long</span>* xp, <span class=\"keyword\">long</span> y)</span>  </span>{\n        <span class=\"keyword\">long</span> x = *xp;\n        *xp = y;\n        <span class=\"keyword\">return</span> x;\n}\n\n<span class=\"comment\">//对应的汇编代码</span>\n<span class=\"comment\">// xp =&gt; %rdi  y ==&gt; %rsi</span>\nmovq    (%rdi), %rax\nmovq    %rsi, (%rdi)\nret\n</code></pre>\n<h3 id=\"条件码\"><a href=\"#条件码\" class=\"headerlink\" title=\"条件码\"></a>条件码</h3><ul>\n<li>CF: 进位标志</li>\n<li>ZF: 零标志</li>\n<li>SF: 符号标志</li>\n<li>OF: 溢出标志</li>\n</ul>\n"}