{"tags":[{"name":"Core HTML5 Canvas","permalink":"http://blog.hellolc.com/tags/Core-HTML5-Canvas/","url":"/async/tags/Core HTML5 Canvas.json","count":2}],"categories":[],"url":"/async/posts/2018/05/01/The-canvas-Element.json","date":1525144967000,"path":{"year":2018,"month":5,"day":1,"name":"The-canvas-Element"},"title":"The canvas Element","permalink":"http://blog.hellolc.com/2018/05/01/The-canvas-Element/","content":"<h3 id=\"css设置canvas大小和canvas元素节点上设置大小区别\"><a href=\"#css设置canvas大小和canvas元素节点上设置大小区别\" class=\"headerlink\" title=\"css设置canvas大小和canvas元素节点上设置大小区别\"></a>css设置canvas大小和canvas元素节点上设置大小区别</h3><blockquote>\n<p>css只会设置元素大小, 无法改变画布表面大小<br>元素节点设置不仅改变元素大小, 也改变画布表面大小</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang=<span class=\"string\">\"en\"</span>&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset=<span class=\"string\">\"UTF-8\"</span>&gt;</span><br><span class=\"line\">    &lt;meta name=<span class=\"string\">\"viewport\"</span> content=<span class=\"string\">\"width=device-width, initial-scale=1.0\"</span>&gt;</span><br><span class=\"line\">    &lt;meta http-equiv=<span class=\"string\">\"X-UA-Compatible\"</span> content=<span class=\"string\">\"ie=edge\"</span>&gt;</span><br><span class=\"line\">    &lt;title&gt;Document&lt;<span class=\"regexp\">/title&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;style&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">        body &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">            background: aqua;</span></span><br><span class=\"line\"><span class=\"regexp\">        &#125;</span></span><br><span class=\"line\"><span class=\"regexp\">        #canvas &#123;</span></span><br><span class=\"line\"><span class=\"regexp\">            background: #fff;</span></span><br><span class=\"line\"><span class=\"regexp\">            /</span>* width: <span class=\"number\">600</span>px;</span><br><span class=\"line\">            height: <span class=\"number\">600</span>px; *<span class=\"regexp\">/</span></span><br><span class=\"line\"><span class=\"regexp\">            margin-left: 200px;</span></span><br><span class=\"line\"><span class=\"regexp\">        &#125;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;/</span>style&gt;</span><br><span class=\"line\">&lt;<span class=\"regexp\">/head&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;body&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    &lt;canvas id=\"canvas\" width=\"600\" height=\"600\"&gt;&lt;/</span>canvas&gt;</span><br><span class=\"line\">    &lt;img id=<span class=\"string\">\"img\"</span>/&gt;</span><br><span class=\"line\">&lt;<span class=\"regexp\">/body&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;script&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">    var canvas = document.getElementById('canvas'),</span></span><br><span class=\"line\"><span class=\"regexp\">    context = canvas.getContext('2d'),</span></span><br><span class=\"line\"><span class=\"regexp\">    FONT_HEIGHT = 15,</span></span><br><span class=\"line\"><span class=\"regexp\">    MARGIN = 35,</span></span><br><span class=\"line\"><span class=\"regexp\">    HAND_TRUNCATION = canvas.width/</span><span class=\"number\">25</span>,</span><br><span class=\"line\">    HOUR_HAND_TRUNCATION = canvas.width/<span class=\"number\">10</span>,</span><br><span class=\"line\">    NUMERAL_SPACING = <span class=\"number\">20</span>,</span><br><span class=\"line\">    RADIUS = canvas.width/<span class=\"number\">2</span> - MARGIN,</span><br><span class=\"line\">    HAND_RADIUS = RADIUS + NUMERAL_SPACING;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">drawCicle</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        context.beginPath();</span><br><span class=\"line\">        context.arc(canvas.width / <span class=\"number\">2</span>, canvas.height / <span class=\"number\">2</span>, RADIUS, <span class=\"number\">0</span>, <span class=\"number\">2</span>*<span class=\"built_in\">Math</span>.PI, <span class=\"literal\">true</span>);</span><br><span class=\"line\">        context.stroke();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">drawCenter</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        context.beginPath();</span><br><span class=\"line\">        context.arc(canvas.width / <span class=\"number\">2</span>, canvas.height / <span class=\"number\">2</span>, <span class=\"number\">5</span>, <span class=\"number\">0</span>, <span class=\"number\">2</span> * <span class=\"built_in\">Math</span>.PI, <span class=\"literal\">true</span>);</span><br><span class=\"line\">        context.fill();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">drawHand</span>(<span class=\"params\">loc, isHour, lineWidth</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> angle = <span class=\"number\">2</span> * <span class=\"built_in\">Math</span>.PI * (loc / <span class=\"number\">60</span>) - <span class=\"built_in\">Math</span>.PI / <span class=\"number\">2</span>;</span><br><span class=\"line\">        handRadius = isHour ? RADIUS - HAND_TRUNCATION-HOUR_HAND_TRUNCATION : RADIUS - HAND_TRUNCATION;</span><br><span class=\"line\"></span><br><span class=\"line\">        context.moveTo(canvas.width / <span class=\"number\">2</span>, canvas.height / <span class=\"number\">2</span>);</span><br><span class=\"line\">        context.lineTo(canvas.width / <span class=\"number\">2</span> + handRadius * <span class=\"built_in\">Math</span>.cos(angle), canvas.height / <span class=\"number\">2</span> + handRadius * <span class=\"built_in\">Math</span>.sin(angle));</span><br><span class=\"line\">        context.lineWidth = lineWidth;</span><br><span class=\"line\">        context.stroke();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">drawHands</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> date = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> hour = date.getHours();</span><br><span class=\"line\"></span><br><span class=\"line\">        hour = hour &gt; <span class=\"number\">12</span> ? hour - <span class=\"number\">12</span> : hour;</span><br><span class=\"line\"></span><br><span class=\"line\">        drawHand(hour * <span class=\"number\">5</span> + date.getMinutes() / <span class=\"number\">60</span> * <span class=\"number\">5</span>, <span class=\"literal\">true</span>, <span class=\"number\">5</span>);</span><br><span class=\"line\">        drawHand(date.getMinutes(), <span class=\"literal\">false</span>, <span class=\"number\">2</span>);</span><br><span class=\"line\">        drawHand(date.getSeconds(), <span class=\"literal\">false</span>, <span class=\"number\">0.3</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">drawNumbers</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> numberList = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>, <span class=\"number\">7</span>, <span class=\"number\">8</span>, <span class=\"number\">9</span>, <span class=\"number\">10</span>, <span class=\"number\">11</span>, <span class=\"number\">12</span>];</span><br><span class=\"line\">        <span class=\"keyword\">var</span> angle = <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> numeralWidth = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        numberList.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">number</span>) </span>&#123;</span><br><span class=\"line\">            angle = <span class=\"number\">2</span> * <span class=\"built_in\">Math</span>.PI * (number - <span class=\"number\">3</span>) / <span class=\"number\">12</span>;</span><br><span class=\"line\">            numeralWidth = context.measureText(number).width;</span><br><span class=\"line\">            context.fillText(number, canvas.width / <span class=\"number\">2</span> + HAND_RADIUS * <span class=\"built_in\">Math</span>.cos(angle) - numeralWidth / <span class=\"number\">2</span>, canvas.height / <span class=\"number\">2</span> + HAND_RADIUS * <span class=\"built_in\">Math</span>.sin(angle) - FONT_HEIGHT / <span class=\"number\">3</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">drawClock</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        context.clearRect(<span class=\"number\">0</span>, <span class=\"number\">0</span>, canvas.width, canvas.height);</span><br><span class=\"line\">        drawCicle();</span><br><span class=\"line\">        drawCenter();</span><br><span class=\"line\">        drawHands();</span><br><span class=\"line\">        drawNumbers();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    context.font = FONT_HEIGHT + <span class=\"string\">'px Arial'</span>;</span><br><span class=\"line\">    <span class=\"comment\">// drawClock();</span></span><br><span class=\"line\">    <span class=\"comment\">// setInterval(drawClock, 1000);</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> image = <span class=\"keyword\">new</span> Image();</span><br><span class=\"line\">    image.src = <span class=\"string\">\"https://mdn.mozillademos.org/files/225/Canvas_drawimage.jpg\"</span>;</span><br><span class=\"line\">    canvas.onmousedown = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">event</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> oriX = event.clientX, oriY = event.clientY;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> bbox = canvas.getBoundingClientRect();</span><br><span class=\"line\">        <span class=\"built_in\">window</span>.onmousemove = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">event</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> x = event.clientX, y = event.clientY;</span><br><span class=\"line\">            context.clearRect(<span class=\"number\">0</span>, <span class=\"number\">0</span>, canvas.width, canvas.height);</span><br><span class=\"line\">            context.strokeRect(oriX - bbox.left, oriY - bbox.top, x - oriX, y - oriY);</span><br><span class=\"line\">            <span class=\"built_in\">window</span>.onmouseup = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">event</span>) </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> x = event.clientX, y = event.clientY;</span><br><span class=\"line\">                <span class=\"built_in\">window</span>.onmousemove = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                <span class=\"built_in\">window</span>.onmousedown = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                context.drawImage(image, oriX - bbox.left, oriY - bbox.top, x - oriX, y - oriY)</span><br><span class=\"line\">                setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> src = canvas.toDataURL(<span class=\"string\">\"image/png\"</span>);</span><br><span class=\"line\">                    <span class=\"built_in\">console</span>.log(src);</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> img = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"img\"</span>);</span><br><span class=\"line\">                    img.setAttribute(<span class=\"string\">'crossOrigin'</span>, <span class=\"string\">'anonymous'</span>);</span><br><span class=\"line\">                    img.src = src;</span><br><span class=\"line\">                &#125;, <span class=\"number\">1000</span>)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&lt;<span class=\"regexp\">/script&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">&lt;/</span>html&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"使用向量计算碰撞\"><a href=\"#使用向量计算碰撞\" class=\"headerlink\" title=\"使用向量计算碰撞\"></a>使用向量计算碰撞</h3><h4 id=\"单元向量-unit-vector\"><a href=\"#单元向量-unit-vector\" class=\"headerlink\" title=\"单元向量 unit vector\"></a>单元向量 unit vector</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> vectorMagnitude = <span class=\"built_in\">Math</span>.sqrt(<span class=\"built_in\">Math</span>.pow(vector.x, <span class=\"number\">2</span>) +</span><br><span class=\"line\">                                  <span class=\"built_in\">Math</span>.pow(vector.y, <span class=\"number\">2</span>)),</span><br><span class=\"line\">      unitVector = <span class=\"keyword\">new</span> Vector();</span><br><span class=\"line\">      unitVector.x = vector.x / vectorMagnitude;</span><br><span class=\"line\">      unitVector.y = vector.y / vectorMagnitude;</span><br></pre></td></tr></table></figure>\n<h4 id=\"向量相加-相减\"><a href=\"#向量相加-相减\" class=\"headerlink\" title=\"向量相加 相减\"></a>向量相加 相减</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> vectorSum = <span class=\"keyword\">new</span> Vector();</span><br><span class=\"line\">  vectorSum.x = vectorOne.x + vectorTwo.x;</span><br><span class=\"line\">  vectorSum.y = vectorOne.y + vectorTwo.y;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> vectorSubtraction = <span class=\"keyword\">new</span> Vector();</span><br><span class=\"line\">  vectorSubtraction.x = vectorOne.x - vectorTwo.x;</span><br><span class=\"line\">  vectorSubtraction.y = vectorOne.y - vectorTwo.y;</span><br></pre></td></tr></table></figure>\n<h4 id=\"The-Dot-Product-of-Two-Vectors-向量点积-计算2个物品是否会碰撞\"><a href=\"#The-Dot-Product-of-Two-Vectors-向量点积-计算2个物品是否会碰撞\" class=\"headerlink\" title=\"The Dot Product of Two Vectors 向量点积 计算2个物品是否会碰撞\"></a>The Dot Product of Two Vectors 向量点积 计算2个物品是否会碰撞</h4><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> dotProduct = vectorOne.x * vectorTwo.x + vectorOne.y * vectorTwo.y; <span class=\"comment\">//正数同方向, 负数反方向</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"计算速度\"><a href=\"#计算速度\" class=\"headerlink\" title=\"计算速度\"></a>计算速度</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pixels / frame = (X ms / frame) * (Y pixels / second);</span><br><span class=\"line\">// ===&gt; 推到出</span><br><span class=\"line\">pixels / frame = X*Y / 1000;</span><br></pre></td></tr></table></figure>"}